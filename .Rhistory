#poolattu pa aineisto
op<-par(mfrow=c(2,2),mar=c(5,4,1,2))
boxplot(pool_pa_change~Hab,data=results,ylab="pool_pa_D",xlab="Habitat")
plot(pool_pa_change~Prev, data = results,ylab="pool_pa_D",xlab="Prevalence")
abline(lm(pool_pa_change~Prev,data = results))
boxplot(pool_pa_change~Mig,data=results,ylab="pool_pa_D",xlab="Migration")
plot(pool_pa_change~logmass, data = results,ylab="pool_pa_D",xlab="log(Mass)")
abline(lm(pool_pa_change~logmass,data = results))
par(op)
#poolattu abu aineisto
op<-par(mfrow=c(2,2),mar=c(5,4,1,2))
boxplot(pool_abu_change~Hab,data=results,ylab="pool_abu_D",xlab="Habitat")
plot(pool_abu_change~Prev, data = results,ylab="pool_abu_D",xlab="Prevalence")
abline(lm(pool_abu_change~Prev,data = results))
boxplot(pool_abu_change~Mig,data=results,ylab="pool_abu_D",xlab="Migration")
plot(pool_abu_change~logmass, data = results,ylab="pool_abu_D",xlab="log(Mass)")
abline(lm(pool_abu_change~logmass,data = results))
par(op)
#luetaan aineisto sisään, Multiphylo eli monta puuta
linnut <- read.nexus("output.nex")
#valitaan vain yksi puu, mikä tahansa sadasta
linnut2<-linnut[[99]]
#define a variance-covariance structure based on the model of Brownian evolution
bm.birds=corBrownian(1,phy=linnut2)
#tehdään fylogenialistasta matriisi
lintupuu<-vcv.phylo(linnut2)
#matriisin voi värittää havainnollistamaan lintulajien sukulaisuutta
heatmap(lintupuu,Rowv = NA,Colv = NA)
#abu-aineistoa varten pari lajia pois
linnut3=drop.tip(linnut2, "Emberiza_rustica", trim.internal = TRUE, subtree = FALSE,
root.edge = 0, rooted = is.rooted(linnut2), collapse.singles = TRUE,
interactive = FALSE)
linnut4=drop.tip(linnut3, "Bonasa_bonasia", trim.internal = TRUE, subtree = FALSE,
root.edge = 0, rooted = is.rooted(linnut2), collapse.singles = TRUE,
interactive = FALSE)
bm.birds2=corBrownian(1,phy=linnut4)
#aineiston rivien nimet muutetaan lattareiksi jolloin keskustelee fylogeniapuun kanssa
rownames(results)=results$species
#luodaan eri mallivaihtoehtoja
malli0 <- gls(pool_pa_change ~ 1, data = results,correlation=bm.birds,method="ML" )
malli1 <- gls(pool_pa_change ~ Mig, data = results,correlation=bm.birds,method="ML")
malli2 <- gls(pool_pa_change ~ Hab, data = results,correlation=bm.birds,method="ML")
malli3 <- gls(pool_pa_change ~ log(Mass), data = results,correlation=bm.birds,method="ML")
malli4 <- gls(pool_pa_change ~ Prev, data = results,correlation=bm.birds,method="ML")
malli5 <- gls(pool_pa_change ~ Mig + Hab, data = results,correlation=bm.birds,method="ML")
malli6 <- gls(pool_pa_change ~ Hab + log(Mass), data = results,correlation=bm.birds,method="ML")
malli7 <- gls(pool_pa_change ~ Mig + log(Mass), data = results,correlation=bm.birds,method="ML")
malli8 <- gls(pool_pa_change ~ log(Mass)+Prev, data = results,correlation=bm.birds,method="ML")
malli9 <- gls(pool_pa_change ~ Mig +Prev, data = results,correlation=bm.birds,method="ML")
malli10 <- gls(pool_pa_change ~ Hab+Prev, data = results,correlation=bm.birds,method="ML")
malli11 <- gls(pool_pa_change ~ Mig + Hab + log(Mass), data = results,correlation=bm.birds,method="ML")
malli12 <- gls(pool_pa_change ~ Mig + Hab + Prev, data = results,correlation=bm.birds,method="ML")
malli13 <- gls(pool_pa_change ~ Mig + Prev + log(Mass), data = results,correlation=bm.birds,method="ML")
malli14 <- gls(pool_pa_change ~ Prev + Hab + log(Mass), data = results,correlation=bm.birds,method="ML")
malli15 <- gls(pool_pa_change ~ Mig + Hab + log(Mass)+Prev, data = results,correlation=bm.birds,method="ML")
#mallin valintaa MuMin paketin avulla
output1<-model.sel(malli0,malli1,malli2,malli3,malli4,malli5,malli6,malli7,malli8,malli9,malli10,malli11,malli12,malli13,malli14,malli15)
# AICc Table
output1
#malli #10 on paras mutta seuraava malli on 0.27 AICc yksikön päässä.
#luodaan eri mallivaihtoehtoja
malli0 <- gls(pool_abu_change ~ 1, data = results,correlation=bm.birds2,method="ML" ,na.action="na.exclude")
malli1 <- gls(pool_abu_change ~ Mig, data = results,correlation=bm.birds2,method="ML",na.action="na.exclude")
malli2 <- gls(pool_abu_change ~ Hab, data = results,correlation=bm.birds2,method="ML",na.action="na.exclude")
malli3 <- gls(pool_abu_change ~ log(Mass), data = results,correlation=bm.birds2,method="ML",na.action="na.exclude")
malli4 <- gls(pool_abu_change ~ Prev, data = results,correlation=bm.birds2,method="ML")
#luodaan eri mallivaihtoehtoja
malli0 <- gls(pool_abu_change ~ 1, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
#luodaan eri mallivaihtoehtoja
malli0 <- gls(pool_abu_change ~ 1, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli1 <- gls(pool_abu_change ~ Mig, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli2 <- gls(pool_abu_change ~ Hab, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli3 <- gls(pool_abu_change ~ log(Mass), data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli4 <- gls(pool_abu_change ~ Prev, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli5 <- gls(pool_abu_change ~ Mig + Hab, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli6 <- gls(pool_abu_change ~ Hab + log(Mass), data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli7 <- gls(pool_abu_change ~ Mig + log(Mass), data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli8 <- gls(pool_abu_change ~ log(Mass)+Prev, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli9 <- gls(pool_abu_change ~ Mig +Prev, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli10 <- gls(pool_abu_change ~ Hab+Prev, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli11 <- gls(pool_abu_change ~ Mig + Hab + log(Mass), data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli12 <- gls(pool_abu_change ~ Mig + Hab + Prev, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli13 <- gls(pool_abu_change ~ Mig + Prev + log(Mass), data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli14 <- gls(pool_abu_change ~ Prev + Hab + log(Mass), data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli15 <- gls(pool_abu_change ~ Mig + Hab + log(Mass)+Prev, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
#mallin valintaa MuMin paketin avulla
output1<-model.sel(malli0,malli1,malli2,malli3,malli4,malli5,malli6,malli7,malli8,malli9,malli10,malli11,malli12,malli13,malli14,malli15)
# AICc Table
output1
#tehdään model averaging
output2<-model.sel(malli8,malli13,malli14)
summary(model.avg(output2, revised.var = TRUE))
# Parameter estimate Table
summary(malli14)
anova(malli14)
# Parameter estimate Table
summary(malli14)
# Parameter estimate Table
summary(malli8)
op<-par(mfrow=c(2,3),mar=c(5,4,1,2))
plot(malli8,add.smooth = F,which = 1)
E<-resid(malli8)
hist(E, xlab = "residuals",main = "")
plot(results$Prev,E,xlab = "prevalence",ylab="residuals")
plot(malli8,add.smooth = F,which = 1,na.action("na.omit"))
op<-par(mfrow=c(2,3),mar=c(5,4,1,2))
plot(malli8,add.smooth = F,which = 1,na.action("na.omit"))
op<-par(mfrow=c(2,3),mar=c(5,4,1,2))
plot(malli8,add.smooth = F,which =1)
E<-resid(malli8)
hist(E, xlab = "residuals",main = "")
plot(results$Prev,E,xlab = "prevalence",ylab="residuals")
plot(results$Prev,E,xlab = "prevalence",ylab="residuals",na.action("na.omit"))
results2=subset(results,species=="Emberiza_rustica"|species=="Bonasa_bonasia")
#luodaan eri mallivaihtoehtoja
malli0 <- gls(pool_abu_change ~ 1, data = results2,correlation=bm.birds2,method="ML")
results2=subset(results,species==!"Emberiza_rustica"|species==!"Bonasa_bonasia")
results2=subset(results,species!=="Emberiza_rustica"|species!=="Bonasa_bonasia")
results2=subset(results,species!="Emberiza_rustica"|species!="Bonasa_bonasia")
View(results2)
View(results2)
results2=subset(results,species!="Emberiza_rustica"|species!="Bonasa_bonasia")
results2=dplyr::subset(results,species!="Emberiza_rustica"|species!="Bonasa_bonasia")
results2=subset(results,species!="Emberiza_rustica"&species!="Bonasa_bonasia")
#luodaan eri mallivaihtoehtoja
malli0 <- gls(pool_abu_change ~ 1, data = results2,correlation=bm.birds2,method="ML")
op<-par(mfrow=c(2,3),mar=c(5,4,1,2))
plot(malli8,add.smooth = F,which =1)
E<-resid(malli8)
hist(E, xlab = "residuals",main = "")
plot(results2$Prev,E,xlab = "prevalence",ylab="residuals")
plot(results2$Hab,E,xlab = "habitat",ylab="residuals")
plot(results2$Mig,E,xlab = "migration",ylab="residuals")
plot(results2$logmass,E,xlab = "logMass",ylab="residuals")
par(op)
observations=read.csv("observation.csv",header = T)
observations=read.csv("observations.csv",header = T)
summary(observations)
observations=read.csv("observations.csv",header = T,sep = ";")
summary(observations)
summary(observations[,1:16])
View(observations)
getwd()
paketit<-c("readr","tidyr","plyr","dplyr","vegan","ggplot2","lattice","psych","glmmTMB","lme4","MASS","MuMIn","mgcv")
lapply(paketit,library,character.only=T)
data<-read.csv("OrtolanBunting.csv")
names(data)
str(data)
summary(data)
#tarkasta kaikkien luokkien muoto
data$id<-as.factor(data$id)
#vuodelle oma faktori-muuttuja
data$fyear<-as.factor(data$year)
#outliers
dotchart(data$terri, main= "N territories")
dotchart(data$prec, main= "precipitation")
dotchart(data$temp, main= "temperature")
dotchart(data$open, main= "open (spring sown)")
dotchart(data$SSS, main= "SSS (small-scale structures)")
hist(data$terri)
table(data$terri)
sort(table(data$id))
#relationships
pairs.panels(data[,c(3:21)])
#plottailua
xyplot(terri~fyear|id, data=data)
boxplot(terri~fyear, data=data)
boxplot(terri~id, data=data)
xyplot(terri~SSS, data=data)
xyplot(terri~open, data=data)
xyplot(terri~cover, data=data)
#Aksun esimerkit (näissä mukana NDVI):
#m1=glmmTMB(N ~Year + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m2=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m3=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year*Temp + Year*Rain + Year*NDVI + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m4=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year*Cropdiv + Year*Plough + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
#m5=glmmTMB(N ~SSS + Landscape + X + Y + X*Y + Year*Temp + Year*Rain + Year*NDVI + Year*Cropdiv + Year*Plough + (1|fYear) + (1|Site), family=nbinom2, data=Embhor)
dataS=data %>%
mutate_at(c(2:3,5:7,9:20), funs(c(scale(.))))
M1=glmmTMB(terri ~ year + (1|fyear)+ (1|id), family=nbinom2, data=dataS)
M2=glmmTMB(terri ~ SSS + agri5 + X*Y + year + (1|fyear) + (1|id), family=nbinom2, data=dataS)
M3=glmmTMB(terri ~ SSS + agri5 + X*Y + year*temp + year*prec  + (1|fyear)  + (1|id), family=nbinom2, data=dataS)
M4=glmmTMB(terri ~ SSS + agri5 + X*Y + year*shan + year*open + (1|fyear) + (1|id), family=nbinom2, data=dataS)
M5=glmmTMB(terri ~ SSS + agri5 + X*Y + year*temp + year*prec + year*shan + year*open + (1|fyear) + (1|id), family=nbinom2, data=dataS)
output1<-model.sel(M1,M2,M3,M4,M5)
# AICc Table
output1
output2=model.sel(M4,M5)
#tehdään model averaging
summary(model.avg(output2, revised.var = TRUE))
summary(M5)
summary(M4)
knitr::opts_chunk$set(echo = TRUE)
getwd()
paketit<-c("nlme","readr","tidyr","dplyr","plyr","magrittr","purrr","ggplot2","ape","geiger","MuMIn","psych","Hmisc")
lapply(paketit,library,character.only=T)
#aineiston valinta, leväyttäminen ja uudelleen nimeäminen
res<-read.csv("results_and_pooled.csv")
res2=subset(res,method=="pool_D")
res3=spread(res2,pa,accuracy)
res3$method=NULL
res4=res3 %>% dplyr::rename(pool_pa_change = pa, pool_abu_change = abu)
#lisätään lajiominaisuudet taulukkoon
traits<-read.csv("traits_table.csv",sep = ";")
results<-inner_join(res4,traits,by="species")
str(results)
#tallenna tarvittaessa omaksi taulukokseen
#write.csv(results,"accuracies_traits.csv",row.names = F)
knitr::opts_chunk$set(echo = TRUE)
getwd()
paketit<-c("nlme","readr","tidyr","dplyr","plyr","magrittr","purrr","ggplot2","ape","geiger","MuMIn","psych","Hmisc")
lapply(paketit,library,character.only=T)
#aineiston valinta, leväyttäminen ja uudelleen nimeäminen
res<-read.csv("results_and_pooled.csv")
res2=subset(res,method=="pool_D")
res3=spread(res2,pa,accuracy)
res3$method=NULL
res4=res3 %>% dplyr::rename(pool_pa_change = pa, pool_abu_change = abu)
#lisätään lajiominaisuudet taulukkoon
traits<-read.csv("traits_table.csv",sep = ";")
results<-inner_join(res4,traits,by="species")
str(results)
#uusi muuttuja, massan logaritmi
results$Lmass<-log(results$Mass)
#tallenna tarvittaessa omaksi taulukokseen
#write.csv(results,"accuracies_traits.csv",row.names = F)
#poolattu pa aineisto
op<-par(mfrow=c(2,2),mar=c(5,4,1,2))
boxplot(pool_pa_change~Hab,data=results,ylab="pool_pa_D",xlab="Habitat")
plot(pool_pa_change~Prev, data = results,ylab="pool_pa_D",xlab="Prevalence")
abline(lm(pool_pa_change~Prev,data = results))
boxplot(pool_pa_change~Mig,data=results,ylab="pool_pa_D",xlab="Migration")
plot(pool_pa_change~logmass, data = results,ylab="pool_pa_D",xlab="log(Mass)")
knitr::opts_chunk$set(echo = TRUE)
getwd()
paketit<-c("nlme","readr","tidyr","dplyr","plyr","magrittr","purrr","ggplot2","ape","geiger","MuMIn","psych","Hmisc")
lapply(paketit,library,character.only=T)
#aineiston valinta, leväyttäminen ja uudelleen nimeäminen
res<-read.csv("results_and_pooled.csv")
res2=subset(res,method=="pool_D")
res3=spread(res2,pa,accuracy)
res3$method=NULL
res4=res3 %>% dplyr::rename(pool_pa_change = pa, pool_abu_change = abu)
#lisätään lajiominaisuudet taulukkoon
traits<-read.csv("traits_table.csv",sep = ";")
results<-inner_join(res4,traits,by="species")
str(results)
#uusi muuttuja, massan logaritmi
results$logmass<-log(results$Mass)
#tallenna tarvittaessa omaksi taulukokseen
#write.csv(results,"accuracies_traits.csv",row.names = F)
#poolattu pa aineisto
op<-par(mfrow=c(2,2),mar=c(5,4,1,2))
boxplot(pool_pa_change~Hab,data=results,ylab="pool_pa_D",xlab="Habitat")
plot(pool_pa_change~Prev, data = results,ylab="pool_pa_D",xlab="Prevalence")
abline(lm(pool_pa_change~Prev,data = results))
boxplot(pool_pa_change~Mig,data=results,ylab="pool_pa_D",xlab="Migration")
plot(pool_pa_change~logmass, data = results,ylab="pool_pa_D",xlab="log(Mass)")
abline(lm(pool_pa_change~logmass,data = results))
par(op)
#poolattu abu aineisto
op<-par(mfrow=c(2,2),mar=c(5,4,1,2))
boxplot(pool_abu_change~Hab,data=results,ylab="pool_abu_D",xlab="Habitat")
plot(pool_abu_change~Prev, data = results,ylab="pool_abu_D",xlab="Prevalence")
abline(lm(pool_abu_change~Prev,data = results))
boxplot(pool_abu_change~Mig,data=results,ylab="pool_abu_D",xlab="Migration")
plot(pool_abu_change~logmass, data = results,ylab="pool_abu_D",xlab="log(Mass)")
abline(lm(pool_abu_change~logmass,data = results))
par(op)
#luetaan aineisto sisään, Multiphylo eli monta puuta
linnut <- read.nexus("output.nex")
#valitaan vain yksi puu, mikä tahansa sadasta
linnut2<-linnut[[99]]
#define a variance-covariance structure based on the model of Brownian evolution
bm.birds=corBrownian(1,phy=linnut2)
#tehdään fylogenialistasta matriisi
lintupuu<-vcv.phylo(linnut2)
#matriisin voi värittää havainnollistamaan lintulajien sukulaisuutta
heatmap(lintupuu,Rowv = NA,Colv = NA)
#abu-aineistoa varten pari lajia pois
linnut3=drop.tip(linnut2, "Emberiza_rustica", trim.internal = TRUE, subtree = FALSE,
root.edge = 0, rooted = is.rooted(linnut2), collapse.singles = TRUE,
interactive = FALSE)
linnut4=drop.tip(linnut3, "Bonasa_bonasia", trim.internal = TRUE, subtree = FALSE,
root.edge = 0, rooted = is.rooted(linnut2), collapse.singles = TRUE,
interactive = FALSE)
bm.birds2=corBrownian(1,phy=linnut4)
#aineiston rivien nimet muutetaan lattareiksi jolloin keskustelee fylogeniapuun kanssa
rownames(results)=results$species
#luodaan eri mallivaihtoehtoja
malli0 <- gls(pool_pa_change ~ 1, data = results,correlation=bm.birds,method="ML" )
malli1 <- gls(pool_pa_change ~ Mig, data = results,correlation=bm.birds,method="ML")
malli2 <- gls(pool_pa_change ~ Hab, data = results,correlation=bm.birds,method="ML")
malli3 <- gls(pool_pa_change ~ log(Mass), data = results,correlation=bm.birds,method="ML")
malli4 <- gls(pool_pa_change ~ Prev, data = results,correlation=bm.birds,method="ML")
malli5 <- gls(pool_pa_change ~ Mig + Hab, data = results,correlation=bm.birds,method="ML")
malli6 <- gls(pool_pa_change ~ Hab + log(Mass), data = results,correlation=bm.birds,method="ML")
malli7 <- gls(pool_pa_change ~ Mig + log(Mass), data = results,correlation=bm.birds,method="ML")
malli8 <- gls(pool_pa_change ~ log(Mass)+Prev, data = results,correlation=bm.birds,method="ML")
malli9 <- gls(pool_pa_change ~ Mig +Prev, data = results,correlation=bm.birds,method="ML")
malli10 <- gls(pool_pa_change ~ Hab+Prev, data = results,correlation=bm.birds,method="ML")
malli11 <- gls(pool_pa_change ~ Mig + Hab + log(Mass), data = results,correlation=bm.birds,method="ML")
malli12 <- gls(pool_pa_change ~ Mig + Hab + Prev, data = results,correlation=bm.birds,method="ML")
malli13 <- gls(pool_pa_change ~ Mig + Prev + log(Mass), data = results,correlation=bm.birds,method="ML")
malli14 <- gls(pool_pa_change ~ Prev + Hab + log(Mass), data = results,correlation=bm.birds,method="ML")
malli15 <- gls(pool_pa_change ~ Mig + Hab + log(Mass)+Prev, data = results,correlation=bm.birds,method="ML")
#mallin valintaa MuMin paketin avulla
output1<-model.sel(malli0,malli1,malli2,malli3,malli4,malli5,malli6,malli7,malli8,malli9,malli10,malli11,malli12,malli13,malli14,malli15)
# AICc Table
output1
#tehdään model averaging
output2<-model.sel(malli0,malli3,malli8,malli4)
summary(model.avg(output2, revised.var = TRUE))
# Parameter estimate Table, katsotaan tarkemmin parasta mallia
summary(malli0)
#luodaan eri mallivaihtoehtoja
malli0 <- gls(pool_pa_change ~ 1, data = results,correlation=bm.birds,method="REML" )
malli1 <- gls(pool_pa_change ~ Mig, data = results,correlation=bm.birds,method="REML")
malli2 <- gls(pool_pa_change ~ Hab, data = results,correlation=bm.birds,method="REML")
malli3 <- gls(pool_pa_change ~ log(Mass), data = results,correlation=bm.birds,method="REML")
malli4 <- gls(pool_pa_change ~ Prev, data = results,correlation=bm.birds,method="REML")
malli5 <- gls(pool_pa_change ~ Mig + Hab, data = results,correlation=bm.birds,method="REML")
malli6 <- gls(pool_pa_change ~ Hab + log(Mass), data = results,correlation=bm.birds,method="REML")
malli7 <- gls(pool_pa_change ~ Mig + log(Mass), data = results,correlation=bm.birds,method="REML")
malli8 <- gls(pool_pa_change ~ log(Mass)+Prev, data = results,correlation=bm.birds,method="REML")
malli9 <- gls(pool_pa_change ~ Mig +Prev, data = results,correlation=bm.birds,method="REML")
malli10 <- gls(pool_pa_change ~ Hab+Prev, data = results,correlation=bm.birds,method="REML")
malli11 <- gls(pool_pa_change ~ Mig + Hab + log(Mass), data = results,correlation=bm.birds,method="REML")
malli12 <- gls(pool_pa_change ~ Mig + Hab + Prev, data = results,correlation=bm.birds,method="REML")
malli13 <- gls(pool_pa_change ~ Mig + Prev + log(Mass), data = results,correlation=bm.birds,method="REML")
malli14 <- gls(pool_pa_change ~ Prev + Hab + log(Mass), data = results,correlation=bm.birds,method="REML")
malli15 <- gls(pool_pa_change ~ Mig + Hab + log(Mass)+Prev, data = results,correlation=bm.birds,method="REML")
#mallin valintaa MuMin paketin avulla
output1<-model.sel(malli0,malli1,malli2,malli3,malli4,malli5,malli6,malli7,malli8,malli9,malli10,malli11,malli12,malli13,malli14,malli15)
# AICc Table
output1
#luodaan eri mallivaihtoehtoja
malli0 <- gls(pool_abu_change ~ 1, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli1 <- gls(pool_abu_change ~ Mig, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli2 <- gls(pool_abu_change ~ Hab, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli3 <- gls(pool_abu_change ~ log(Mass), data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli4 <- gls(pool_abu_change ~ Prev, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli5 <- gls(pool_abu_change ~ Mig + Hab, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli6 <- gls(pool_abu_change ~ Hab + log(Mass), data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli7 <- gls(pool_abu_change ~ Mig + log(Mass), data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli8 <- gls(pool_abu_change ~ log(Mass)+Prev, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli9 <- gls(pool_abu_change ~ Mig +Prev, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli10 <- gls(pool_abu_change ~ Hab+Prev, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli11 <- gls(pool_abu_change ~ Mig + Hab + log(Mass), data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli12 <- gls(pool_abu_change ~ Mig + Hab + Prev, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli13 <- gls(pool_abu_change ~ Mig + Prev + log(Mass), data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli14 <- gls(pool_abu_change ~ Prev + Hab + log(Mass), data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli15 <- gls(pool_abu_change ~ Mig + Hab + log(Mass)+Prev, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
#mallin valintaa MuMin paketin avulla
output1<-model.sel(malli0,malli1,malli2,malli3,malli4,malli5,malli6,malli7,malli8,malli9,malli10,malli11,malli12,malli13,malli14,malli15)
# AICc Table
output1
#tehdään model averaging
output2<-model.sel(malli8,malli13,malli14)
summary(model.avg(output2, revised.var = TRUE))
# Parameter estimate Table
summary(malli8)
#plottaus ei toimi jos aineistoissa on eri määrä havaintoja
results2=subset(results,species!="Emberiza_rustica" & species!="Bonasa_bonasia")
#seuraavaksi mallin validointia kuvaajista
op<-par(mfrow=c(2,3),mar=c(5,4,1,2))
plot(malli8,add.smooth = F,which =1)
E<-resid(malli8)
hist(E, xlab = "residuals",main = "")
plot(results2$Prev,E,xlab = "prevalence",ylab="residuals")
plot(results2$Hab,E,xlab = "habitat",ylab="residuals")
plot(results2$Mig,E,xlab = "migration",ylab="residuals")
plot(results2$logmass,E,xlab = "logMass",ylab="residuals")
par(op)
#luodaan eri mallivaihtoehtoja
malli0 <- gls(pool_abu_change ~ 1, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli1 <- gls(pool_abu_change ~ Mig, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli2 <- gls(pool_abu_change ~ Hab, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli3 <- gls(pool_abu_change ~ logmass, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli4 <- gls(pool_abu_change ~ Prev, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli5 <- gls(pool_abu_change ~ Mig + Hab, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli6 <- gls(pool_abu_change ~ Hab + logmass, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli7 <- gls(pool_abu_change ~ Mig + logmass, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli8 <- gls(pool_abu_change ~ logmass+Prev, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli9 <- gls(pool_abu_change ~ Mig +Prev, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli10 <- gls(pool_abu_change ~ Hab+Prev, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli11 <- gls(pool_abu_change ~ Mig + Hab + logmass, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli12 <- gls(pool_abu_change ~ Mig + Hab + Prev, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli13 <- gls(pool_abu_change ~ Mig + Prev + logmass, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli14 <- gls(pool_abu_change ~ Prev + Hab + logmass, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli15 <- gls(pool_abu_change ~ Mig + Hab + logmass+Prev, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
#mallin valintaa MuMin paketin avulla
output1<-model.sel(malli0,malli1,malli2,malli3,malli4,malli5,malli6,malli7,malli8,malli9,malli10,malli11,malli12,malli13,malli14,malli15)
# AICc Table
output1
#tehdään model averaging
output2<-model.sel(malli8,malli13,malli14)
summary(model.avg(output2, revised.var = TRUE))
# Parameter estimate Table
summary(malli8)
#plottaus ei toimi jos aineistoissa on eri määrä havaintoja
results2=subset(results,species!="Emberiza_rustica" & species!="Bonasa_bonasia")
#seuraavaksi mallin validointia kuvaajista
op<-par(mfrow=c(2,3),mar=c(5,4,1,2))
plot(malli8,add.smooth = F,which =1)
E<-resid(malli8)
hist(E, xlab = "residuals",main = "")
plot(results2$Prev,E,xlab = "prevalence",ylab="residuals")
plot(results2$Hab,E,xlab = "habitat",ylab="residuals")
plot(results2$Mig,E,xlab = "migration",ylab="residuals")
plot(results2$logmass,E,xlab = "logMass",ylab="residuals")
par(op)
#luodaan eri mallivaihtoehtoja
malli0 <- gls(pool_abu_change ~ 1, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli1 <- gls(pool_abu_change ~ Mig, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli2 <- gls(pool_abu_change ~ Hab, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli3 <- gls(pool_abu_change ~ logmass, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli4 <- gls(pool_abu_change ~ Prev, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli5 <- gls(pool_abu_change ~ Mig + Hab, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli6 <- gls(pool_abu_change ~ Hab + logmass, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli7 <- gls(pool_abu_change ~ Mig + logmass, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli8 <- gls(pool_abu_change ~ logmass+Prev, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli9 <- gls(pool_abu_change ~ Mig +Prev, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli10 <- gls(pool_abu_change ~ Hab+Prev, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli11 <- gls(pool_abu_change ~ Mig + Hab + logmass, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli12 <- gls(pool_abu_change ~ Mig + Hab + Prev, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli13 <- gls(pool_abu_change ~ Mig + Prev + logmass, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli14 <- gls(pool_abu_change ~ Prev + Hab + logmass, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli15 <- gls(pool_abu_change ~ Mig + Hab + logmass+Prev, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
#mallin valintaa MuMin paketin avulla
output1<-model.sel(malli0,malli1,malli2,malli3,malli4,malli5,malli6,malli7,malli8,malli9,malli10,malli11,malli12,malli13,malli14,malli15)
# AICc Table
output1
summary(malli4)
#seuraavaksi mallin validointia kuvaajista
op<-par(mfrow=c(2,3),mar=c(5,4,1,2))
plot(malli4,add.smooth = F,which =1)
E<-resid(malli4)
hist(E, xlab = "residuals",main = "")
plot(results2$Prev,E,xlab = "prevalence",ylab="residuals")
plot(results2$Hab,E,xlab = "habitat",ylab="residuals")
plot(results2$Mig,E,xlab = "migration",ylab="residuals")
plot(results2$logmass,E,xlab = "logMass",ylab="residuals")
par(op)
m.lm <- gls(pool_abu_change ~ Mig + Hab + log(Mass)+Prev, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
vf1<-varExp(form=~Prev)
m.gls3 <- gls(pool_abu_change ~ Mig + Hab + log(Mass)+Prev, weights=vf1, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
anova(m.lm,m.gls3)
vf2<-varExp(~logmass)
m.gls1 <- gls(pool_abu_change ~ Mig + Hab + log(Mass)+Prev, weights=vf2, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
m.lm <- gls(pool_abu_change ~ Mig + Hab + log(Mass)+Prev, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
vf1<-varExp(form=~Prev)
m.gls3 <- gls(pool_abu_change ~ Mig + Hab + log(Mass)+Prev, weights=vf1, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
anova(m.lm,m.gls3)
vf2<-varExp(form=~logmass)
m.gls1 <- gls(pool_abu_change ~ Mig + Hab + log(Mass)+Prev, weights=vf2, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
anova(m.lm,m.gls1)
malli0 <- gls(pool_abu_change ~ 1, weights=vf1, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
#luodaan eri mallivaihtoehtoja
malli0 <- gls(pool_abu_change ~ 1, weights=vf1, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli1 <- gls(pool_abu_change ~ Mig, weights=vf1, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli2 <- gls(pool_abu_change ~ Hab, weights=vf1, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli3 <- gls(pool_abu_change ~ logmass, weights=vf1, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli4 <- gls(pool_abu_change ~ Prev, weights=vf1, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli5 <- gls(pool_abu_change ~ Mig + Hab, weights=vf1, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli6 <- gls(pool_abu_change ~ Hab + logmass, weights=vf1, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli7 <- gls(pool_abu_change ~ Mig + logmass, weights=vf1, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli8 <- gls(pool_abu_change ~ logmass+Prev, weights=vf1, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli9 <- gls(pool_abu_change ~ Mig +Prev, weights=vf1, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli10 <- gls(pool_abu_change ~ Hab+Prev, weights=vf1, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli11 <- gls(pool_abu_change ~ Mig + Hab + logmass, weights=vf1, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli12 <- gls(pool_abu_change ~ Mig + Hab + Prev, weights=vf1, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli13 <- gls(pool_abu_change ~ Mig + Prev + logmass, weights=vf1, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli14 <- gls(pool_abu_change ~ Prev + Hab + logmass, weights=vf1, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
malli15 <- gls(pool_abu_change ~ Mig + Hab + logmass+Prev, weights=vf1, data = results,correlation=bm.birds2,method="REML",na.action="na.omit")
#mallin valintaa MuMin paketin avulla
output1<-model.sel(malli0,malli1,malli2,malli3,malli4,malli5,malli6,malli7,malli8,malli9,malli10,malli11,malli12,malli13,malli14,malli15)
# AICc Table
output1
summary(malli4)
summary(malli1)
op<-par(mfrow=c(2,3),mar=c(5,4,1,2))
plot(malli1,add.smooth = F,which =1)
E<-resid(malli1,type="normalized")#huom! tässä oltava normalized residuaalit
hist(E, xlab = "residuals",main = "")
plot(results2$Prev,E,xlab = "prevalence",ylab="residuals")
plot(results2$Hab,E,xlab = "habitat",ylab="residuals")
plot(results2$Mig,E,xlab = "migration",ylab="residuals")
plot(results2$logmass,E,xlab = "logMass",ylab="residuals")
par(op)
#luodaan eri mallivaihtoehtoja
malli0 <- gls(pool_abu_change ~ 1, weights=vf1, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli1 <- gls(pool_abu_change ~ Mig, weights=vf1, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli2 <- gls(pool_abu_change ~ Hab, weights=vf1, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli3 <- gls(pool_abu_change ~ logmass, weights=vf1, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli4 <- gls(pool_abu_change ~ Prev, weights=vf1, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli5 <- gls(pool_abu_change ~ Mig + Hab, weights=vf1, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli6 <- gls(pool_abu_change ~ Hab + logmass, weights=vf1, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli7 <- gls(pool_abu_change ~ Mig + logmass, weights=vf1, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli8 <- gls(pool_abu_change ~ logmass+Prev, weights=vf1, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli9 <- gls(pool_abu_change ~ Mig +Prev, weights=vf1, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli10 <- gls(pool_abu_change ~ Hab+Prev, weights=vf1, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli11 <- gls(pool_abu_change ~ Mig + Hab + logmass, weights=vf1, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli12 <- gls(pool_abu_change ~ Mig + Hab + Prev, weights=vf1, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli13 <- gls(pool_abu_change ~ Mig + Prev + logmass, weights=vf1, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli14 <- gls(pool_abu_change ~ Prev + Hab + logmass, weights=vf1, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
malli15 <- gls(pool_abu_change ~ Mig + Hab + logmass+Prev, weights=vf1, data = results,correlation=bm.birds2,method="ML",na.action="na.omit")
#mallin valintaa MuMin paketin avulla
output1<-model.sel(malli0,malli1,malli2,malli3,malli4,malli5,malli6,malli7,malli8,malli9,malli10,malli11,malli12,malli13,malli14,malli15)
# AICc Table
output1
summary(malli1)
