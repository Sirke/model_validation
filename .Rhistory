write.csv(res2,"results_and_pooled.csv",row.names=F)
traits<-read.csv("traits_table.csv",sep = ";")
table=res2%>%unite("method",method,pa)%>%spread(method, accuracy)%>%inner_join(.,traits,by="species")
summary(table)
write.csv(table,"table.csv")
#plottailua
ggplot(res2, aes(x = method, y = accuracy,  colour = pa)) + geom_boxplot() +facet_grid(.~pa)
res3=subset(res2,method=="D"|method=="pool_D")
res3$method=drop.levels(res3$method)
summary(res3)
ggplot(res3, aes(x = method, y = accuracy, interaction = pa, colour = pa)) + geom_boxplot()
res3%>%
group_by(method,pa) %>%
summarise(means=mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
res3%>%
group_by(method,pa)
res3%>%
group_by(species,method,pa) %>%
summarise(means=mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
#fixed osan vertailua
A1=lme(accuracy~method*pa,data=res3,random=~1|species,method="ML",na.action="na.exclude")
A2=lme(accuracy~method+pa,data=res3,random=~1|species,method="ML",na.action="na.exclude")
A3=lme(accuracy~method,data=res3,random=~1|species,method="ML",na.action="na.exclude")
A4=lme(accuracy~pa,data=res3,random=~1|species,method="ML",na.action="na.exclude")
anova(A1,A2)
AIC(A1,A2,A3,A4)
summary(A1)
anova(A1)
#lopullinen malli
A1_final=lme(accuracy~method*pa,data=res3,random=~1|species,method="REML",na.action="na.exclude")
summary(A1_final)
#validointi
plot(A1_final)
E1=resid(A1_final, type="normalized")
F1=fitted(A1_final)
par(mfrow=c(2,2), mar=c(5,5,2,2))
plot(x=F1,y=E1,xlab="fitted",ylab="residuals")
abline(h=0,lty=2)
boxplot(E1~method,xlab="method",ylab="residuals",data=res3)
abline(h=0,lty=2)
boxplot(E1~pa,xlab="pa",ylab="residuals",data=res3)
abline(h=0,lty=2)
par(mfrow=c(1,1), mar=c(5,5,2,2))
boxplot(E1~species,xlab="species",ylab="residuals",data=res3)
abline(h=0,lty=2)
res4=subset(res2,method=="C"|method=="pool_C")
res4$method=drop.levels(res4$method)
summary(res4)
ggplot(res4, aes(x = method, y = accuracy, interaction = pa, colour = pa)) + geom_boxplot()
res4%>%
group_by(method,pa) %>%
summarise(means=mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
#fixed osan vertailua
A1=lme(accuracy~method*pa,data=res4,random=~1|species,method="ML",na.action="na.exclude")
A2=lme(accuracy~method+pa,data=res4,random=~1|species,method="ML",na.action="na.exclude")
A3=lme(accuracy~method,data=res4,random=~1|species,method="ML",na.action="na.exclude")
A4=lme(accuracy~pa,data=res4,random=~1|species,method="ML",na.action="na.exclude")
anova(A1,A2)
AIC(A1,A2,A3,A4)
summary(A1)
anova(A1)
res4%>%
group_by(method,pa)
res5=subset(res2,method=="B"|method=="pool_B")
res5$method=drop.levels(res5$method)
summary(res5)
ggplot(res5, aes(x = method, y = accuracy, interaction = pa, colour = pa)) + geom_boxplot()
res5%>%
group_by(method,pa) %>%
summarise(means=mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
#fixed osan vertailua
A1=lme(accuracy~method*pa,data=res5,random=~1|species,method="ML",na.action="na.exclude")
A2=lme(accuracy~method+pa,data=res5,random=~1|species,method="ML",na.action="na.exclude")
A3=lme(accuracy~method,data=res5,random=~1|species,method="ML",na.action="na.exclude")
A4=lme(accuracy~pa,data=res5,random=~1|species,method="ML",na.action="na.exclude")
anova(A1,A2)
AIC(A1,A2,A3,A4)
summary(A1)
anova(A1)
res6=subset(res2,method=="A"|method=="pool_A")
res6$method=drop.levels(res6$method)
summary(res6)
ggplot(res6, aes(x = method, y = accuracy, interaction = pa, colour = pa)) + geom_boxplot()
res6%>%
group_by(method,pa) %>%
summarise(means=mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
#fixed osan vertailua
A1=lme(accuracy~method*pa,data=res6,random=~1|species,method="ML",na.action="na.exclude")
A2=lme(accuracy~method+pa,data=res6,random=~1|species,method="ML",na.action="na.exclude")
A3=lme(accuracy~method,data=res6,random=~1|species,method="ML",na.action="na.exclude")
A4=lme(accuracy~pa,data=res6,random=~1|species,method="ML",na.action="na.exclude")
anova(A1,A2)
AIC(A1,A2,A3,A4)
summary(A1)
anova(A1)
#aineisto uusiksi
poolres=res2
poolres$pool=NA
poolres$pool[poolres$method=="A"|poolres$method=="B"|poolres$method=="C"|poolres$method=="D"]<-"NPo"
poolres$pool[poolres$method=="pool_A"|poolres$method=="pool_B"|poolres$method=="pool_C"|poolres$method=="pool_D"]<-"Po"
poolres$pool=as.factor(poolres$pool)
poolres$method=stringr::str_replace(poolres$method,'pool_','')
poolres$method=as.factor(poolres$method)
#tarkistellaan taulukkona
poolres %>%
group_by(method,pa,pool) %>%
summarise(means=mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
#plottailua
ggplot(poolres,aes(x=method,y=accuracy,color=pool))+geom_boxplot()+facet_grid(.~pa)
#tallenna
write.csv(poolres, "poolres.csv",row.names = F)
#jaetaan aineisto pa ja abu aineistoihin
poolresPA=subset(poolres,pa=="pa")
poolresABU=subset(poolres,pa=="abu")
#fixed osan vertailua, PA aineisto:
A1=lme(accuracy~method*pool,data=poolresPA,random=~1|species,method="ML",na.action="na.exclude")
A2=lme(accuracy~method+pool,data=poolresPA,random=~1|species,method="ML",na.action="na.exclude")
A3=lme(accuracy~method,data=poolresPA,random=~1|species,method="ML",na.action="na.exclude")
A4=lme(accuracy~pool,data=poolresPA,random=~1|species,method="ML",na.action="na.exclude")
anova(A1,A2)
AIC(A1,A2,A3,A4)
summary(A3)
anova(A3)
#fixed osan vertailua, abu aineisto:
A1=lme(accuracy~method*pool,data=poolresABU,random=~1|species,method="ML",na.action="na.exclude")
A2=lme(accuracy~method+pool,data=poolresABU,random=~1|species,method="ML",na.action="na.exclude")
A3=lme(accuracy~method,data=poolresABU,random=~1|species,method="ML",na.action="na.exclude")
A4=lme(accuracy~pool,data=poolresABU,random=~1|species,method="ML",na.action="na.exclude")
anova(A1,A2)
AIC(A1,A2,A3,A4)
summary(A1)
anova(A1)
stat <- summarySE(res3, measurevar="accuracy", groupvars=c("method","pa"),na.rm = T)
stat
stat$lower=stat$accuracy-stat$ci
stat$upper=stat$accuracy+stat$ci
names(stat)[2] <- "Data_type"
stat$method=revalue(stat$method, c("D"="D", "pool_D"="pooled D"))
knitr::kable(stat)
names(res3)[4] <- "Data_type"
res3$method=revalue(res3$method, c("D"="D", "pool_D"="pooled D"))
pd <- position_dodge(0.2) # move them .05 to the left and right
# Black error bars - notice the mapping of 'group=supp' -- without it, the error
# bars won't be dodged!
ggplot(stat, aes(y=accuracy, x=method,shape=Data_type)) + geom_errorbar(aes(ymin=accuracy-ci, ymax=accuracy+ci), colour="black", width=.2, position=pd) +ylab("Prediction accuracy") +
xlab("Validation method") +
theme_bw() +
theme(legend.justification=c(1,1),
legend.position=c(0.3,0.95),
legend.box.background=element_rect())  +
theme(text = element_text(size = 20)) +
geom_point(position=pd, size=4) +  scale_shape_discrete(name = "Data type", labels = c("abu", "POC")) + scale_shape_manual(values=c(17,19))
ggsave("plot2_simple.png")
ggplot(stat, aes(y=accuracy, x=method,shape=Data_type)) +
geom_errorbar(aes(ymin=accuracy-ci, ymax=accuracy+ci), colour="black", width=.2, position=pd) +
ylab("Prediction accuracy") +
xlab("Validation method") +
theme_bw() +
theme(legend.justification=c(1,1),
legend.position=c(0.23,0.95),
legend.box.background=element_rect())  +
theme(text = element_text(size = 15)) +
geom_point(position=pd, size=4) +
scale_shape_discrete(name = "Data type", labels = c("abundance", "occurrence")) + geom_hline(yintercept = 0, linetype="dashed")+
geom_point(data=res3,position=pd, alpha=0.08)
ggsave("plot2_alpha.png")
ggplot(stat, aes(y=accuracy, x=method,shape=Data_type)) +
geom_errorbar(aes(ymin=accuracy-ci, ymax=accuracy+ci), colour="black", width=.2, position=pd) +
ylab("Prediction accuracy") +
xlab("Validation method") +
theme_bw() +
theme(legend.justification=c(1,1),
legend.position=c(0.23,0.95),
legend.box.background=element_rect())  +
theme(text = element_text(size = 15)) +
geom_point(position=pd, size=4) +
scale_shape_discrete(name = "Data type", labels = c("abundance", "occurrence")) + geom_hline(yintercept = 0, linetype="dashed")+
geom_point(data=res3,position=pd, size=0.5)
ggsave("plot2_noalpha.png")
stat <- summarySE(res2, measurevar="accuracy", groupvars=c("method","pa"),na.rm = T)
stat
stat$lower=stat$accuracy-stat$ci
stat$upper=stat$accuracy+stat$ci
names(stat)[2] <- "Data_type"
stat$method=revalue(stat$method, c("D"="D", "pool_D"="pooled D"))
knitr::kable(stat)
names(res2)[4] <- "Data_type"
res2$method=revalue(res2$method, c("D"="D", "pool_D"="pooled D"))
pd <- position_dodge(0.2) # move them .05 to the left and right
# Black error bars - notice the mapping of 'group=supp' -- without it, the error
# bars won't be dodged!
#ggplot(stat, aes(x=method, y=accuracy, group=Data_type)) +
#    geom_errorbar(aes(ymin=accuracy-ci, ymax=accuracy+ci), colour="black", width=.2, position=pd) +
#    geom_point(aes(shape=Data_type),position=pd, size=4)+
#    scale_shape_manual(values=c(19,17))+
#    ylab("Prediction accuracy") +
##    xlab("Validation method") +
#    theme_bw() +
#    theme(legend.justification=c(1,1),
#          legend.position=c(0.3,0.95),
#          legend.box.background=element_rect())  +             # Position legend in bottom right
#    theme(text = element_text(size = 17)) +
#    labs(fill = "Data type")
ggplot(stat, aes(y=accuracy, x=method,shape=Data_type)) + geom_errorbar(aes(ymin=accuracy-ci, ymax=accuracy+ci), colour="black", width=.2, position=pd) +ylab("Prediction accuracy") +
xlab("Validation method") +
theme_bw() +
theme(legend.justification=c(1,1),
legend.position=c(0.3,0.95),
legend.box.background=element_rect())  +
theme(text = element_text(size = 20)) +
geom_point(position=pd, size=4) +  scale_shape_discrete(name = "Data type", labels = c("abu", "POC")) + scale_shape_manual(values=c(17,19))
ggsave("plot2_allmethods_simple.png")
ggplot(stat, aes(y=accuracy, x=method,shape=Data_type)) +
geom_errorbar(aes(ymin=accuracy-ci, ymax=accuracy+ci), colour="black", width=.2, position=pd) +
ylab("Prediction accuracy") +
xlab("Validation method") +
theme_bw() +
theme(legend.justification=c(1,1),
legend.position=c(0.23,0.95),
legend.box.background=element_rect())  +
theme(text = element_text(size = 15)) +
geom_point(position=pd, size=4) +
scale_shape_discrete(name = "Data type", labels = c("abundance", "occurrence")) + geom_hline(yintercept = 0, linetype="dashed")+
geom_point(data=res2,position=pd, alpha=0.08)
ggsave("plot2_allmethods_alpha.png")
ggplot(stat, aes(y=accuracy, x=method,shape=Data_type)) +
geom_errorbar(aes(ymin=accuracy-ci, ymax=accuracy+ci), colour="black", width=.2, position=pd) +
ylab("Prediction accuracy") +
xlab("Validation method") +
theme_bw() +
theme(legend.justification=c(1,1),
legend.position=c(0.23,0.30),
legend.box.background=element_rect())  +
theme(text = element_text(size = 15)) +
geom_point(position=pd, size=4) +
scale_shape_discrete(name = "Data type", labels = c("abundance", "occurrence")) + geom_hline(yintercept = 0, linetype="dashed")+
geom_point(data=res2,position=pd, size=0.5)
ggsave("plot2_allmethods_noalpha.png")
stat <- summarySE(poolres, measurevar="accuracy", groupvars=c("method","pa","pool"),na.rm = T)
stat
stat$lower=stat$accuracy-stat$ci
stat$upper=stat$accuracy+stat$ci
#names(stat)[2] <- "Data_type"
#names(stat)[3] <- "Spatial_scale"
#stat$pool=revalue(stat$pool, c("NPo"="non-pooled", "Po"="pooled"))
knitr::kable(stat)
#names(res2)[4] <- "Data_type"
pd <- position_dodge(0.4) # move them .05 to the left and right
# Black error bars - notice the mapping of 'group=supp' -- without it, the error
# bars won't be dodged!
#levels(stat$pa) <- c("pa", "abu")
#levels(poolres$pa) <- c("pa", "abu")
poolres$pa=revalue(poolres$pa, c("pa"="occurrence", "abu"="abundance"))
stat$pa=revalue(stat$pa, c("pa"="occurrence", "abu"="abundance"))
stat$pool=revalue(stat$pool, c("NPo"="non-pooled", "Po"="pooled"))
stat$pa=factor(stat$pa, levels=c("occurrence","abundance"))
ggplot(stat, aes(y=accuracy, x=method, group=pool)) +
geom_point(aes(shape=pool),position=pd,size=2.5)  +
scale_shape_manual(values=c(19,17),name = "Spatial scale") +
geom_errorbar(aes(ymin=accuracy-ci, ymax=accuracy+ci), colour="black", width=.4, position=pd) +
ylab("Prediction accuracy") +
xlab("Validation method") +
theme_bw() +
theme(legend.justification=c(1,1),
legend.box.background=element_rect()) +
theme(text = element_text(size = 15)) +
geom_point(data=poolres,position=pd, size=0.5) +
facet_grid(.~pa) +
geom_hline(yintercept = 0, linetype="dashed") +
theme(legend.title = element_text(colour="black", size=10,
face="bold")) +
theme(legend.text = element_text(colour="black", size=10,
face="bold"))
ggsave("plot3_pa_pool_method.png")
poolres %>%
group_by(method,pa,pool) %>%
summarise(means=mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
#tarkistellaan taulukkona
poolres %>%
poolres %>%
group_by(method,pa,pool) %>%
summarise_at(vars(accuracy),list(~mean(., na.rm=T),std.errors=std.error(accuracy,na.rm=T))
1
poolres %>%
group_by(method,pa,pool) %>%
summarise_at(vars(accuracy),list(~mean(., na.rm=T),std.errors=std.error(accuracy,na.rm=T))
View(poolres)
View(poolres)
poolres %>%
group_by(species,method,pa,pool) %>%
summarise(means=mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
poolres %>%
group_by(species,method,pa,pool)
#tarkistellaan taulukkona
poolres %>%
group_by(species) %>%
summarise(means=mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
poolres %>%
group_by(species)
poolres %>%
group_by(species) %>%
summarise(means=mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
poolres %>%
group_by(method) %>%
summarise(means=mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
poolres %>%
group_by(pool) %>%
summarise(means=mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
#tarkistellaan taulukkona
by_species = poolres %>% group_by(species) %>%
summarise(means=mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
#tarkistellaan taulukkona
by_species = poolres %>% group_by(species) %>%
means =   by_species %>% summarise(mean = mean())
#tarkistellaan taulukkona
by_species = poolres %>% group_by(species)
means =   by_species %>% summarise(mean = mean())
by_species
by_species
#tarkistellaan taulukkona
by_species = poolres %>% group_by(pa)
by_species
by_species%>% summarise(
mean = mean(accuracy))
by_species%>% summarise(
mean = mean(accuracy,na.rm=T))
#tarkistellaan taulukkona
by_pa = poolres %>% group_by(pool)
by_pa%>% summarise(
mean = mean(accuracy,na.rm=T))
#tarkistellaan taulukkona
by_pa = poolres %>% dplyr::group_by(pool)
by_pa%>% summarise(
mean = mean(accuracy,na.rm=T))
by_pa%>% dplyr::summarise(
mean = mean(accuracy,na.rm=T))
by_pa%>% dplyr::summarise(
mean = mean(accuracy,na.rm=T))
poolres %>%
group_by(pool) %>%
summarise(mean = mean(accuracy), n = n())
poolres %>%
group_by(pool) %>%
summarise(mean = mean(accuracy))
poolres %>%
group_by(pool) %>%
summarise(mean = mean(accuracy,na.rm=T))
#tarkistellaan taulukkona
poolres %>%
group_by(method, pa, pool) %>%
summarise(mean = mean(accuracy,na.rm=T))
#tarkistellaan taulukkona
res2 %>%
group_by(method, pa) %>%
summarise(mean = mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
#tarkistellaan taulukkona
res2 %>%
group_by(method, Data_type) %>%
summarise(mean = mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
#lopullinen malli
mfinal=lme(accuracy~method,data=poolresPA,random=~1|species,method="REML",na.action="na.exclude")
summary(mfinal)
#validointi
plot(mfinal)
E1=resid(mfinal, type="normalized")
F1=fitted(mfinal)
par(mfrow=c(2,2), mar=c(5,5,2,2))
plot(x=F1,y=E1,xlab="fitted",ylab="residuals")
abline(h=0,lty=2)
boxplot(E1~method,xlab="method",ylab="residuals",data=res3)
#validointi
plot(mfinal)
E1=resid(mfinal, type="normalized")
F1=fitted(mfinal)
par(mfrow=c(2,2), mar=c(5,5,2,2))
plot(x=F1,y=E1,xlab="fitted",ylab="residuals")
abline(h=0,lty=2)
boxplot(E1~method,xlab="method",ylab="residuals",data=poolresPA)
abline(h=0,lty=2)
boxplot(E1~pa,xlab="pa",ylab="residuals",data=poolresPA)
abline(h=0,lty=2)
par(mfrow=c(1,1), mar=c(5,5,2,2))
boxplot(E1~species,xlab="species",ylab="residuals",data=poolresPA)
abline(h=0,lty=2)
#lopullinen malli
mfinal=lme(accuracy~method*pool,data=poolresABU,random=~1|species,method="REML",na.action="na.exclude")
summary(mfinal)
#validointi
plot(mfinal)
E1=resid(mfinal, type="normalized")
F1=fitted(mfinal)
par(mfrow=c(2,2), mar=c(5,5,2,2))
plot(x=F1,y=E1,xlab="fitted",ylab="residuals")
abline(h=0,lty=2)
boxplot(E1~method,xlab="method",ylab="residuals",data=poolresABU)
abline(h=0,lty=2)
par(mfrow=c(1,1), mar=c(5,5,2,2))
boxplot(E1~species,xlab="species",ylab="residuals",data=poolresABU)
abline(h=0,lty=2)
#lopullinen malli
mfinal=lme(accuracy~method,data=poolresPA,random=~1|species,method="REML",na.action="na.exclude")
summary(mfinal)
#validointi
plot(mfinal)
E1=resid(mfinal, type="normalized")
F1=fitted(mfinal)
par(mfrow=c(2,2), mar=c(5,5,2,2))
plot(x=F1,y=E1,xlab="fitted",ylab="residuals")
abline(h=0,lty=2)
boxplot(E1~method,xlab="method",ylab="residuals",data=poolresPA)
abline(h=0,lty=2)
par(mfrow=c(1,1), mar=c(5,5,2,2))
boxplot(E1~species,xlab="species",ylab="residuals",data=poolresPA)
abline(h=0,lty=2)
knitr::opts_chunk$set(echo = TRUE)
getwd()
paketit<-c("visreg","nlme","readr","tidyr","dplyr","plyr","magrittr","purrr","ggplot2","ape","geiger","MuMIn","psych","Hmisc")
lapply(paketit,library,character.only=T)
#aineiston valinta, leväyttäminen ja uudelleen nimeäminen
poolres<-read.csv("poolres.csv")
#lisätään lajiominaisuudet taulukkoon
traits<-read.csv("traits_table.csv",sep = ";")
results<-inner_join(poolres,traits,by="species")
str(results)
#uusi muuttuja, massan logaritmi
results$logmass<-log(results$Mass)
#uusi muuttuja, log-muunnettu prevalenssi
results$PrevS=log(results$Prev)
#jaetaan aineisto pa ja abu aineistoihin
resPA=subset(results,pa=="pa")
resABU=subset(results,pa=="abu")
#pa aineisto
ggplot(resPA, aes(x=Hab, y=accuracy)) +
geom_boxplot(aes(fill=method))+ facet_grid(. ~pool ) +
ggtitle("occurrence data")
ggplot(resABU, aes(x=Hab, y=accuracy)) +
geom_boxplot(aes(fill=method))+ facet_grid(. ~pool ) +
ggtitle("abundance data")
#pa aineisto
ggplot(resPA, aes(x=Mig, y=accuracy)) +
geom_boxplot(aes(fill=method))+ facet_grid(. ~pool ) +
ggtitle("occurrence data")
ggplot(resABU, aes(x=Mig, y=accuracy)) +
geom_boxplot(aes(fill=method))+ facet_grid(. ~pool ) +
ggtitle("abundance data")
#pa aineisto
ggplot(resPA, aes(x=PrevS, y=accuracy,shape=method)) +
geom_point () +
geom_smooth(method=lm) +
ggtitle("occurrence data") +
facet_grid(. ~pool)
#pa aineisto
ggplot(resPA, aes(x=PrevS, y=accuracy,color=method)) +
geom_point () +
geom_smooth(method=lm) +
ggtitle("occurrence data") +
facet_grid(. ~pool)
ggplot(resABU, aes(x=PrevS, y=accuracy,color=method)) +
geom_point()+
geom_smooth(method=lm) +
facet_grid(. ~pool ) +
ggtitle("abundance data")
#pa aineisto
ggplot(resPA, aes(x=logmass, y=accuracy,color=method)) +
geom_point () +
geom_smooth(method=lm) +
ggtitle("occurrence data") +
facet_grid(. ~pool)
#abu
ggplot(resABU, aes(x=logmass, y=accuracy,color=method)) +
geom_point()+
geom_smooth(method=lm) +
facet_grid(. ~pool ) +
ggtitle("abundance data")
cor(results$logmass,results$PrevS)
pairs(results[8:9])
View(results)
#luodaan eri mallivaihtoehtoja
malli0 <- gls(accuracy ~ 1, data = resPA,correlation=bm.birds,method="ML")
#luetaan aineisto sisään, Multiphylo eli monta puuta
linnut <- read.nexus("output.nex")
#valitaan vain yksi puu, mikä tahansa sadasta
linnut2<-linnut[[99]]
#define a variance-covariance structure based on the model of Brownian evolution
bm.birds=corBrownian(1,phy=linnut2)
#tehdään fylogenialistasta matriisi
lintupuu<-vcv.phylo(linnut2)
#matriisin voi värittää havainnollistamaan lintulajien sukulaisuutta
heatmap(lintupuu,Rowv = NA,Colv = NA)
#abu-aineistoa varten pari lajia pois, muuten koodi ei toimi
linnut3=drop.tip(linnut2, "Emberiza_rustica", trim.internal = TRUE, subtree = FALSE,
root.edge = 0, rooted = is.rooted(linnut2), collapse.singles = TRUE,
interactive = FALSE)
linnut4=drop.tip(linnut3, "Bonasa_bonasia", trim.internal = TRUE, subtree = FALSE,
root.edge = 0, rooted = is.rooted(linnut2), collapse.singles = TRUE,
interactive = FALSE)
bm.birds2=corBrownian(1,phy=linnut4)
#aineiston rivien nimet muutetaan lattareiksi jolloin keskustelee fylogeniapuun kanssa
rownames(results)=results$species
results$species=as.factor(results$species)
#uusi muuttuja, massan logaritmi
results$logmass<-log(results$Mass)
#uusi muuttuja, log-muunnettu prevalenssi
results$PrevS=log(results$Prev)
#tallenna tarvittaessa omaksi taulukokseen
#write.csv(results,"accuracies_traits.csv",row.names = F)
rownames(resPA)
#aineiston rivien nimet muutetaan lattareiksi jolloin keskustelee fylogeniapuun kanssa
rownames(resPA)=resPA$species
View(resPA)
#luodaan eri mallivaihtoehtoja
malli0 <- gls(accuracy ~ 1, data = resPA,correlation=bm.birds,method="ML") #pa-aineistolle bm.birds
