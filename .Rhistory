pd <- position_dodge(0.7) # move them .05 to the left and right
#muokataan muuttujia hieman
g$Mig <- factor(g$Mig, levels=c("L", "R", "S"), labels=c("long-distance", "resident","short-distance"))
g$pool <- factor(g$pool, levels=c("NPo", "Po"), labels=c("local", "regional"))
g$Hab <- factor(g$Hab, levels=c("CU", "FO","MM","WE"), labels=c("cultural", "forests","mountain/mire", "wetland"))
g %>%
arrange(fit) %>%
mutate(migration = factor(Mig, levels=c("long-distance", "short-distance", "resident"))) %>%
ggplot(aes(Hab, fit, color = migration, group=migration)) +
theme_bw() +
geom_errorbar(aes(ymin=lwr, ymax=upr), width=.1, position=pd) +
geom_point(position=pd) +
facet_grid(pool ~ method)+
xlab("Habitat preference")+
ylab("Prediction accuracy")+
theme(axis.text.x = element_text(angle = 45, vjust = 0.9, hjust=0.9))+
scale_color_viridis(discrete = TRUE, option = "D")+
scale_fill_viridis(discrete = TRUE)
ggsave("pa_predictions_plot.pdf",device="pdf",width=20,height=12,units="cm")
#yritys jossa logmass ja prevS ovat vuorotellen keskiarvoja
mean_mass2=mean(resABU$logmass)
#med_mass=median(resABU$logmass)
min_prev2 <- min(resABU$PrevS)
max_prev2 <- max(resABU$PrevS)
newdata3 <- expand.grid(PrevS = (seq(from = min_prev2,to = max_prev2, length.out = 10)),
logmass = mean_mass2,
method = c("A","B","C","D"),
pool = c("NPo","Po"),
Mig = c("L", "R","S"),
accuracy=0,
species="Acrocephalus_palustris")
c=predict.MCMCglmm(object = m9A, newdata = newdata3, interval = "prediction", type = "response", marginal=m9A$Random$species)
c=cbind(newdata3,c)
#muokataan muuttujia hieman
c$Mig <- factor(c$Mig, levels=c("L", "R", "S"), labels=c("long-distance", "resident","short-distance"))
c$pool <- factor(c$pool, levels=c("NPo", "Po"), labels=c("local", "regional"))
c %>% arrange(PrevS) %>%
mutate(PrevS=exp(PrevS))%>%
mutate(migration = factor(Mig, levels=c("long-distance", "short-distance", "resident"))) %>%
ggplot(aes(x=PrevS, y=fit, colour = migration, group=migration, ymin = lwr, ymax = upr)) +
theme_bw()+
geom_line() +
geom_ribbon(alpha = 0.2, color = FALSE)+
facet_grid(pool ~ method) +
xlab("Prevalence")+
ylab("Prediction accuracy")+
scale_x_continuous(breaks=c(0.3,0.6, 0.9),labels=c("0.3","0.6","0.9"))
ggsave("prevalence.pdf",device="pdf",width=20,height=12,units="cm")
#PrevS keskiarvoksi ja uudet arvot massalle
mean_prev=mean(resABU$PrevS)
#med_mass=median(resABU$logmass)
min_mass <- min(resABU$logmass)
max_mass<- max(resABU$logmass)
newdata4 <- expand.grid(logmass = (seq(from = min_mass,to = max_mass, length.out = 10)),
PrevS = mean_prev,
method = c("A","B","C","D"),
pool = c("NPo","Po"),
Mig = c("L", "R","S"),
accuracy=0,
species="Parus_major")
t=predict.MCMCglmm(object = m9A, newdata = newdata4, interval = "prediction", type = "response", marginal=m9A$Random$species)
t=cbind(newdata4,t)
#muokataan muuttujia hieman
t$Mig <- factor(t$Mig, levels=c("L", "R", "S"), labels=c("long-distance", "resident","short-distance"))
t$pool <- factor(t$pool, levels=c("NPo", "Po"), labels=c("local", "regional"))
t %>% arrange(logmass) %>%
mutate(logmass=exp(logmass))%>%
mutate(migration = factor(Mig, levels=c("long-distance", "short-distance", "resident"))) %>%
ggplot(aes(x=logmass, y=fit, colour = migration, group=migration, ymin = lwr, ymax = upr)) +
theme_bw()+
geom_line() +
geom_ribbon(alpha = 0.2, color = FALSE)+
facet_grid(pool ~ method)+
xlab("Mass (kg)")+
ylab("Prediction accuracy")+
scale_x_continuous(breaks=c(0,5000, 10000),labels=c("0","5","10"))
ggsave("mass.pdf",device="pdf",width=20,height=12,units="cm")
#kaikki data sisään
res<-read.csv("results_with_NA.csv") #jo aiemmin lasketut ei-poolatut tarkkuudet
pool_pa<-read.csv("pa_pool50_results.csv")
pool_abu<-read.csv("abu_pool50_results.csv")
pool_paC=read.csv("pa_pool50_results_methodC.csv")
pool_paB=read.csv("pa_pool50_results_methodB.csv")
pool_paA=read.csv("pa_pool50_results_methodA.csv")
pool_abuC=read.csv("abu_pool50_results_methodC.csv")
pool_abuB=read.csv("abu_pool50_results_methodB.csv")
pool_abuA=read.csv("abu_pool50_results_methodA.csv")
#100km gridi
#pool_pa<-read.csv("pa_pool100_results.csv")
#pool_abu<-read.csv("abu_pool100_results.csv")
#muokataan taulukoita
pool_pa$method=as.factor("pool_D")
pool_pa$pa=as.factor("pa")
pool_abu$method=as.factor("pool_D")
pool_abu$pa=as.factor("abu")
pool_pa=pool_pa %>% dplyr::rename(species = Yspecies, accuracy = pool_pa_change)
pool_abu=pool_abu %>% dplyr::rename(species = Yspecies,accuracy = pool_abu_change)
pool_paC$method=as.factor("pool_C")
pool_paB$method=as.factor("pool_B")
pool_paA$method=as.factor("pool_A")
pool_paC$pa=as.factor("pa")
pool_paB$pa=as.factor("pa")
pool_paA$pa=as.factor("pa")
pool_abuC$method=as.factor("pool_C")
pool_abuB$method=as.factor("pool_B")
pool_abuA$method=as.factor("pool_A")
pool_abuC$pa=as.factor("abu")
pool_abuB$pa=as.factor("abu")
pool_abuA$pa=as.factor("abu")
helpabu=rbind(pool_abuC,pool_abuB,pool_abuA)
helppa=rbind(pool_paC,pool_paB,pool_paA)
helpabu=helpabu %>% dplyr::rename(species = Yspecies, accuracy = pool_abu_change)
helppa=helppa %>% dplyr::rename(species = Yspecies,accuracy = pool_pa_change)
help=rbind(helpabu,helppa)
#yhdistetään kaikki tulokset samaan taulukkoon
res2=rbind(res,pool_abu,pool_pa,help)
str(res2)
summary(res2)
res2$accuracy[res2$species == "Emberiza_rustica" & res2$method == "pool_D" & res2$pa == "abu"] <- NA
res2$accuracy[res2$species == "Bonasa_bonasia" & res2$method == "pool_D" & res2$pa == "abu"] <- NA
res2$accuracy[res2$species == "Emberiza_rustica" & res2$method == "pool_C" & res2$pa == "abu"] <- NA
res2$accuracy[res2$species == "Bonasa_bonasia" & res2$method == "pool_C" & res2$pa == "abu"] <- NA
#tallennetaan
write.csv(res2,"results_and_pooled.csv",row.names=F)
traits<-read.csv("traits_table.csv",sep = ";")
table=res2%>%unite("method",method,pa)%>%spread(method, accuracy)%>%inner_join(.,traits,by="species")
summary(table)
write.csv(table,"table.csv")
#plottailua
ggplot(res2, aes(x = method, y = accuracy,  colour = pa)) + geom_boxplot() +facet_grid(.~pa)
#aineisto uusiksi, lisään muuttujan 'pool' , joka jakaa tarkkuudet ei-poolattuihin ja poolattuihin
poolres=res2
poolres$pool=NA
poolres$pool[poolres$method=="A"|poolres$method=="B"|poolres$method=="C"|poolres$method=="D"]<-"NPo"
poolres$pool[poolres$method=="pool_A"|poolres$method=="pool_B"|poolres$method=="pool_C"|poolres$method=="pool_D"]<-"Po"
poolres$pool=as.factor(poolres$pool)
poolres$method=stringr::str_replace(poolres$method,'pool_','')
poolres$method=as.factor(poolres$method)
#tarkistellaan taulukkona, tää ei nyt jostain syystä skulaa?!
poolres %>%
group_by(method, pa, pool) %>%
summarise(mean = mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
#tallenna
write.csv(poolres, "poolres.csv",row.names = F)
#jaetaan aineisto pa ja abu aineistoihin
poolresPA=subset(poolres,pa=="pa")
poolresABU=subset(poolres,pa=="abu")
#luetaan aineisto sisään, Multiphylo eli monta puuta
linnut <- read.nexus("output.nex")
#valitaan vain yksi puu, mikä tahansa sadasta
linnut2<-linnut[[99]]
#tehdään puusta malliin sopiva fylogeniarakenne
bm.birds<-inverseA(linnut2)$Ainv
stat <- summarySE(poolres, measurevar="accuracy", groupvars=c("method","pa","pool"),na.rm = T)
knitr::opts_chunk$set(echo = TRUE)
paketit<-c("readr","tidyr","plyr","dplyr","magrittr","purrr","data.table","plotrix","jtools","sp","GISTools","rgdal","sf","spatialEco","ggplot2","lme4","nlme","ggpubr","rstatix","Rmisc","gdata","MCMCglmm","MuMIn")
lapply(paketit,library,character.only=T)
stat <- summarySE(poolres, measurevar="accuracy", groupvars=c("method","pa","pool"),na.rm = T)
stat
stat$lower=stat$accuracy-stat$ci
stat$upper=stat$accuracy+stat$ci
#names(stat)[2] <- "Data_type"
#names(stat)[3] <- "Spatial_scale"
#stat$pool=revalue(stat$pool, c("NPo"="non-pooled", "Po"="pooled"))
knitr::kable(stat)
#names(res2)[4] <- "Data_type"
pd <- position_dodge(0.4) # move them .05 to the left and right
# Black error bars - notice the mapping of 'group=supp' -- without it, the error
# bars won't be dodged!
poolres$pa=revalue(poolres$pa, c("pa"="occurrence", "abu"="abundance"))
stat$pa=revalue(stat$pa, c("pa"="occurrence", "abu"="abundance"))
stat$pool=revalue(stat$pool, c("NPo"="local, non-pooled", "Po"="regional, pooled"))
stat$pa=factor(stat$pa, levels=c("occurrence","abundance"))
ggplot(stat, aes(y=accuracy, x=method, group=pool)) +
geom_point(aes(shape=pool),position=pd,size=2.5)  +
scale_shape_manual(values=c(19,17),name = "Spatial scale") +
geom_errorbar(aes(ymin=accuracy-ci, ymax=accuracy+ci), colour="black", width=.4, position=pd) +
ylab("Prediction accuracy") +
xlab("Validation method") +
theme_bw() +
theme(legend.justification=c(1,1),
legend.box.background=element_rect()) +
theme(text = element_text(size = 15)) +
geom_point(data=poolres,position=pd, size=0.5) +
facet_grid(.~pa) +
geom_hline(yintercept = 0, linetype="dashed") +
theme(legend.title = element_text(colour="black", size=10,
face="bold")) +
theme(legend.text = element_text(colour="black", size=10,
face="bold"))
ggsave("plot3_pa_pool_method.pdf")
c %>% arrange(PrevS) %>%
mutate(PrevS=exp(PrevS))%>%
mutate(migration = factor(Mig, levels=c("long-distance", "short-distance", "resident"))) %>%
ggplot(aes(x=PrevS, y=fit, colour = migration, group=migration, ymin = lwr, ymax = upr)) +
theme_bw()+
geom_line() +
geom_ribbon(alpha = 0.2, color = FALSE)+
facet_grid(pool ~ method) +
xlab("Prevalence")+
ylab("Prediction accuracy")+
scale_x_continuous(breaks=c(0.3,0.6, 0.9),labels=c("0.3","0.6","0.9"))+
scale_color_viridis(discrete = TRUE, option = "D")+
scale_fill_viridis(discrete = TRUE)
#yritys jossa logmass ja prevS ovat vuorotellen keskiarvoja
mean_mass2=mean(resABU$logmass)
#med_mass=median(resABU$logmass)
min_prev2 <- min(resABU$PrevS)
max_prev2 <- max(resABU$PrevS)
newdata3 <- expand.grid(PrevS = (seq(from = min_prev2,to = max_prev2, length.out = 10)),
logmass = mean_mass2,
method = c("A","B","C","D"),
pool = c("NPo","Po"),
Mig = c("L", "R","S"),
accuracy=0,
species="Acrocephalus_palustris")
c=predict.MCMCglmm(object = m9A, newdata = newdata3, interval = "prediction", type = "response", marginal=m9A$Random$species)
knitr::opts_chunk$set(echo = TRUE)
getwd()
paketit<-c("lme4","nlme","readr","tidyr","plyr","dplyr","magrittr","purrr","ggplot2","ape","MuMIn","Hmisc","MCMCglmm","bayesplot","rstanarm","ggeffects","viridis")
lapply(paketit,library,character.only=T)
c=predict.MCMCglmm(object = m9A, newdata = newdata3, interval = "prediction", type = "response", marginal=m9A$Random$species)
c=cbind(newdata3,c)
#muokataan muuttujia hieman
c$Mig <- factor(c$Mig, levels=c("L", "R", "S"), labels=c("long-distance", "resident","short-distance"))
c$pool <- factor(c$pool, levels=c("NPo", "Po"), labels=c("local", "regional"))
c %>% arrange(PrevS) %>%
mutate(PrevS=exp(PrevS))%>%
mutate(migration = factor(Mig, levels=c("long-distance", "short-distance", "resident"))) %>%
ggplot(aes(x=PrevS, y=fit, colour = migration, group=migration, ymin = lwr, ymax = upr)) +
theme_bw()+
geom_line() +
geom_ribbon(alpha = 0.2, color = FALSE)+
facet_grid(pool ~ method) +
xlab("Prevalence")+
ylab("Prediction accuracy")+
scale_x_continuous(breaks=c(0.3,0.6, 0.9),labels=c("0.3","0.6","0.9"))
c %>% arrange(PrevS) %>%
mutate(PrevS=exp(PrevS))%>%
mutate(migration = factor(Mig, levels=c("long-distance", "short-distance", "resident"))) %>%
ggplot(aes(x=PrevS, y=fit, colour = migration, group=migration, ymin = lwr, ymax = upr)) +
theme_bw()+
geom_line() +
geom_ribbon(alpha = 0.2, color = FALSE)+
facet_grid(pool ~ method) +
xlab("Prevalence")+
ylab("Prediction accuracy")+
scale_x_continuous(breaks=c(0.3,0.6, 0.9),labels=c("0.3","0.6","0.9"))+
scale_color_viridis(discrete = TRUE, option = "D")+
scale_fill_viridis(discrete = TRUE)
#yritys jossa logmass ja prevS ovat vuorotellen keskiarvoja
mean_mass2=mean(resABU$logmass)
#med_mass=median(resABU$logmass)
min_prev2 <- min(resABU$PrevS)
max_prev2 <- max(resABU$PrevS)
newdata3 <- expand.grid(PrevS = (seq(from = min_prev2,to = max_prev2, length.out = 10)),
logmass = mean_mass2,
method = c("A","B","C","D"),
pool = c("NPo","Po"),
Mig = c("L", "R","S"),
accuracy=0,
species="Acrocephalus_palustris")
c=predict.MCMCglmm(object = m9A, newdata = newdata3, interval = "prediction", type = "response", marginal=m9A$Random$species)
c=cbind(newdata3,c)
#muokataan muuttujia hieman
c$Mig <- factor(c$Mig, levels=c("L", "R", "S"), labels=c("long-distance", "resident","short-distance"))
c$pool <- factor(c$pool, levels=c("NPo", "Po"), labels=c("local", "regional"))
c %>% arrange(PrevS) %>%
mutate(PrevS=exp(PrevS))%>%
mutate(migration = factor(Mig, levels=c("long-distance", "short-distance", "resident"))) %>%
ggplot(aes(x=PrevS, y=fit, colour = migration, group=migration, ymin = lwr, ymax = upr)) +
theme_bw()+
geom_line() +
geom_ribbon(alpha = 0.2, color = FALSE)+
facet_grid(pool ~ method) +
xlab("Prevalence")+
ylab("Prediction accuracy")+
scale_x_continuous(breaks=c(0.3,0.6, 0.9),labels=c("0.3","0.6","0.9"))+
scale_color_viridis(discrete = TRUE, option = "D")+
scale_fill_viridis(discrete = TRUE)
ggsave("prevalence.pdf",device="pdf",width=20,height=12,units="cm")
#PrevS keskiarvoksi ja uudet arvot massalle
mean_prev=mean(resABU$PrevS)
#med_mass=median(resABU$logmass)
min_mass <- min(resABU$logmass)
max_mass<- max(resABU$logmass)
newdata4 <- expand.grid(logmass = (seq(from = min_mass,to = max_mass, length.out = 10)),
PrevS = mean_prev,
method = c("A","B","C","D"),
pool = c("NPo","Po"),
Mig = c("L", "R","S"),
accuracy=0,
species="Parus_major")
t=predict.MCMCglmm(object = m9A, newdata = newdata4, interval = "prediction", type = "response", marginal=m9A$Random$species)
t=cbind(newdata4,t)
#muokataan muuttujia hieman
t$Mig <- factor(t$Mig, levels=c("L", "R", "S"), labels=c("long-distance", "resident","short-distance"))
t$pool <- factor(t$pool, levels=c("NPo", "Po"), labels=c("local", "regional"))
t %>% arrange(logmass) %>%
mutate(logmass=exp(logmass))%>%
mutate(migration = factor(Mig, levels=c("long-distance", "short-distance", "resident"))) %>%
ggplot(aes(x=logmass, y=fit, colour = migration, group=migration, ymin = lwr, ymax = upr)) +
theme_bw()+
geom_line() +
geom_ribbon(alpha = 0.2, color = FALSE)+
facet_grid(pool ~ method)+
xlab("Mass (kg)")+
ylab("Prediction accuracy")+
scale_x_continuous(breaks=c(0,5000, 10000),labels=c("0","5","10"))+
scale_color_viridis(discrete = TRUE, option = "D")+
scale_fill_viridis(discrete = TRUE)
ggsave("mass.pdf",device="pdf",width=20,height=12,units="cm")
#yritys jossa logmass ja prevS ovat vuorotellen keskiarvoja
mean_mass2=mean(resABU$logmass)
#med_mass=median(resABU$logmass)
min_prev2 <- min(resABU$PrevS)
max_prev2 <- max(resABU$PrevS)
newdata3 <- expand.grid(PrevS = (seq(from = min_prev2,to = max_prev2, length.out = 10)),
logmass = mean_mass2,
method = c("A","B","C","D"),
pool = c("NPo","Po"),
Mig = c("L", "R","S"),
accuracy=0,
species="Acrocephalus_palustris")
c=predict.MCMCglmm(object = m9A, newdata = newdata3, interval = "prediction", type = "response", marginal=m9A$Random$species)
c=cbind(newdata3,c)
#muokataan muuttujia hieman
c$Mig <- factor(c$Mig, levels=c("L", "R", "S"), labels=c("long-distance", "resident","short-distance"))
c$pool <- factor(c$pool, levels=c("NPo", "Po"), labels=c("local", "regional"))
c %>% arrange(PrevS) %>%
mutate(PrevS=exp(PrevS))%>%
mutate(migration = factor(Mig, levels=c("long-distance", "short-distance", "resident"))) %>%
ggplot(aes(x=PrevS, y=fit, colour = migration, group=migration, ymin = lwr, ymax = upr)) +
theme_bw()+
geom_line() +
geom_ribbon(alpha = 0.2, color = FALSE)+
facet_grid(pool ~ method) +
xlab("Prevalence")+
ylab("Prediction accuracy")+
scale_x_continuous(breaks=c(0.3,0.6, 0.9),labels=c("0.3","0.6","0.9"))+
scale_color_viridis(discrete = TRUE, option = "D")+
scale_fill_viridis(discrete = TRUE)
ggsave("prevalence.png",device="png",width=20,height=12,units="cm")
#PrevS keskiarvoksi ja uudet arvot massalle
mean_prev=mean(resABU$PrevS)
#med_mass=median(resABU$logmass)
min_mass <- min(resABU$logmass)
max_mass<- max(resABU$logmass)
newdata4 <- expand.grid(logmass = (seq(from = min_mass,to = max_mass, length.out = 10)),
PrevS = mean_prev,
method = c("A","B","C","D"),
pool = c("NPo","Po"),
Mig = c("L", "R","S"),
accuracy=0,
species="Parus_major")
t=predict.MCMCglmm(object = m9A, newdata = newdata4, interval = "prediction", type = "response", marginal=m9A$Random$species)
t=cbind(newdata4,t)
#muokataan muuttujia hieman
t$Mig <- factor(t$Mig, levels=c("L", "R", "S"), labels=c("long-distance", "resident","short-distance"))
t$pool <- factor(t$pool, levels=c("NPo", "Po"), labels=c("local", "regional"))
t %>% arrange(logmass) %>%
mutate(logmass=exp(logmass))%>%
mutate(migration = factor(Mig, levels=c("long-distance", "short-distance", "resident"))) %>%
ggplot(aes(x=logmass, y=fit, colour = migration, group=migration, ymin = lwr, ymax = upr)) +
theme_bw()+
geom_line() +
geom_ribbon(alpha = 0.2, color = FALSE)+
facet_grid(pool ~ method)+
xlab("Mass (kg)")+
ylab("Prediction accuracy")+
scale_x_continuous(breaks=c(0,5000, 10000),labels=c("0","5","10"))+
scale_color_viridis(discrete = TRUE, option = "D")+
scale_fill_viridis(discrete = TRUE)
ggsave("mass.png",device="png",width=20,height=12,units="cm")
med_mass=median(resABU$logmass)
hist(resABU$logmass)
hist(c$fit)
hist(t$fit)
exp(-1.24)
newdata3 <- expand.grid(PrevS = (seq(from = min_prev2,to = max_prev2, length.out = 10)),
#logmass = mean_mass2,
logmass=2.5,
method = c("A","B","C","D"),
pool = c("NPo","Po"),
Mig = c("L", "R","S"),
accuracy=0,
species="Acrocephalus_palustris")
c=predict.MCMCglmm(object = m9A, newdata = newdata3, interval = "prediction", type = "response", marginal=m9A$Random$species)
knitr::opts_chunk$set(echo = TRUE)
getwd()
paketit<-c("lme4","nlme","readr","tidyr","plyr","dplyr","magrittr","purrr","ggplot2","ape","MuMIn","Hmisc","MCMCglmm","bayesplot","rstanarm","ggeffects","viridis")
lapply(paketit,library,character.only=T)
c=predict.MCMCglmm(object = m9A, newdata = newdata3, interval = "prediction", type = "response", marginal=m9A$Random$species)
c=cbind(newdata3,c)
#muokataan muuttujia hieman
c$Mig <- factor(c$Mig, levels=c("L", "R", "S"), labels=c("long-distance", "resident","short-distance"))
c$pool <- factor(c$pool, levels=c("NPo", "Po"), labels=c("local", "regional"))
c %>% arrange(PrevS) %>%
mutate(PrevS=exp(PrevS))%>%
mutate(migration = factor(Mig, levels=c("long-distance", "short-distance", "resident"))) %>%
ggplot(aes(x=PrevS, y=fit, colour = migration, group=migration, ymin = lwr, ymax = upr)) +
theme_bw()+
geom_line() +
geom_ribbon(alpha = 0.2, color = FALSE)+
facet_grid(pool ~ method) +
xlab("Prevalence")+
ylab("Prediction accuracy")+
scale_x_continuous(breaks=c(0.3,0.6, 0.9),labels=c("0.3","0.6","0.9"))+
scale_color_viridis(discrete = TRUE, option = "D")+
scale_fill_viridis(discrete = TRUE)
newdata3 <- expand.grid(PrevS = (seq(from = min_prev2,to = max_prev2, length.out = 10)),
#logmass = mean_mass2,
logmass=8.5,
method = c("A","B","C","D"),
pool = c("NPo","Po"),
Mig = c("L", "R","S"),
accuracy=0,
species="Acrocephalus_palustris")
c=predict.MCMCglmm(object = m9A, newdata = newdata3, interval = "prediction", type = "response", marginal=m9A$Random$species)
c=predict.MCMCglmm(object = m9A, newdata = newdata3, interval = "prediction", type = "response", marginal=m9A$Random$species)
c=cbind(newdata3,c)
#muokataan muuttujia hieman
c$Mig <- factor(c$Mig, levels=c("L", "R", "S"), labels=c("long-distance", "resident","short-distance"))
#muokataan muuttujia hieman
c$Mig <- factor(c$Mig, levels=c("L", "R", "S"), labels=c("long-distance", "resident","short-distance"))
c$pool <- factor(c$pool, levels=c("NPo", "Po"), labels=c("local", "regional"))
c %>% arrange(PrevS) %>%
mutate(PrevS=exp(PrevS))%>%
mutate(migration = factor(Mig, levels=c("long-distance", "short-distance", "resident"))) %>%
ggplot(aes(x=PrevS, y=fit, colour = migration, group=migration, ymin = lwr, ymax = upr)) +
theme_bw()+
geom_line() +
geom_ribbon(alpha = 0.2, color = FALSE)+
facet_grid(pool ~ method) +
xlab("Prevalence")+
ylab("Prediction accuracy")+
scale_x_continuous(breaks=c(0.3,0.6, 0.9),labels=c("0.3","0.6","0.9"))+
scale_color_viridis(discrete = TRUE, option = "D")+
scale_fill_viridis(discrete = TRUE)
#yritys jossa logmass ja prevS ovat vuorotellen keskiarvoja
mean_mass2=mean(resABU$logmass)
#med_mass=median(resABU$logmass)
min_prev2 <- min(resABU$PrevS)
max_prev2 <- max(resABU$PrevS)
newdata3 <- expand.grid(PrevS = (seq(from = min_prev2,to = max_prev2, length.out = 10)),
#logmass = mean_mass2,
logmass=8.5,
method = c("A","B","C","D"),
pool = c("NPo","Po"),
Mig = c("L", "R","S"),
accuracy=0,
species="Acrocephalus_palustris")
c=predict.MCMCglmm(object = m9A, newdata = newdata3, interval = "prediction", type = "response", marginal=m9A$Random$species)
c=cbind(newdata3,c)
#muokataan muuttujia hieman
c$Mig <- factor(c$Mig, levels=c("L", "R", "S"), labels=c("long-distance", "resident","short-distance"))
c$pool <- factor(c$pool, levels=c("NPo", "Po"), labels=c("local", "regional"))
c %>% arrange(PrevS) %>%
mutate(PrevS=exp(PrevS))%>%
mutate(migration = factor(Mig, levels=c("long-distance", "short-distance", "resident"))) %>%
ggplot(aes(x=PrevS, y=fit, colour = migration, group=migration, ymin = lwr, ymax = upr)) +
theme_bw()+
geom_line() +
geom_ribbon(alpha = 0.2, color = FALSE)+
facet_grid(pool ~ method) +
xlab("Prevalence")+
ylab("Prediction accuracy")+
scale_x_continuous(breaks=c(0.3,0.6, 0.9),labels=c("0.3","0.6","0.9"))+
scale_color_viridis(discrete = TRUE, option = "D")+
scale_fill_viridis(discrete = TRUE)
newdata3 <- expand.grid(PrevS = (seq(from = min_prev2,to = max_prev2, length.out = 10)),
#logmass = mean_mass2,
logmass=8.5,
method = c("A","B","C","D"),
pool = c("NPo","Po"),
Mig = c("L", "R","S"),
accuracy=0,
species="Parus_major")
c=predict.MCMCglmm(object = m9A, newdata = newdata3, interval = "prediction", type = "response", marginal=m9A$Random$species)
c=cbind(newdata3,c)
#muokataan muuttujia hieman
c$Mig <- factor(c$Mig, levels=c("L", "R", "S"), labels=c("long-distance", "resident","short-distance"))
c$pool <- factor(c$pool, levels=c("NPo", "Po"), labels=c("local", "regional"))
c %>% arrange(PrevS) %>%
mutate(PrevS=exp(PrevS))%>%
mutate(migration = factor(Mig, levels=c("long-distance", "short-distance", "resident"))) %>%
ggplot(aes(x=PrevS, y=fit, colour = migration, group=migration, ymin = lwr, ymax = upr)) +
theme_bw()+
geom_line() +
geom_ribbon(alpha = 0.2, color = FALSE)+
facet_grid(pool ~ method) +
xlab("Prevalence")+
ylab("Prediction accuracy")+
scale_x_continuous(breaks=c(0.3,0.6, 0.9),labels=c("0.3","0.6","0.9"))+
scale_color_viridis(discrete = TRUE, option = "D")+
scale_fill_viridis(discrete = TRUE)
newdata3 <- expand.grid(PrevS = (seq(from = min_prev2,to = max_prev2, length.out = 10)),
logmass = mean_mass2,
method = c("A","B","C","D"),
pool = c("NPo","Po"),
Mig = c("L", "R","S"),
#accuracy=0,
species="Parus_major")
c=predict.MCMCglmm(object = m9A, newdata = newdata3, interval = "prediction", type = "response", marginal=m9A$Random$species)
View(newdata3)
newdata3 <- expand.grid(PrevS = (seq(from = min_prev2,to = max_prev2, length.out = 10)),
logmass = mean_mass2,
method = c("A","B","C","D"),
pool = c("NPo","Po"),
Mig = c("L", "R","S"),
accuracy=0,
species="Parus_major")
