output1
#malli #10 on paras mutta seuraava malli on 0.27 AICc yksikön päässä.
#tehdään model averaging
summary(model.avg(output1, revised.var = TRUE))
# Parameter estimate Table, katsotaan tarkemmin parasta mallia
summary(malli0)
summary(malli3)
getwd()
localDir = "."
PredictionDir = file.path(localDir, "data")
paketit<-c("readr","tidyr","dplyr","plyr","magrittr","purrr","data.table","plotrix","jtools","sp","GISTools","rgdal","sf","spatialEco","ggplot2","ggrepel")
lapply(paketit,library,character.only=T)
knitr::opts_chunk$set(echo = TRUE)
getwd()
localDir = "."
PredictionDir = file.path(localDir, "data")
paketit<-c("readr","tidyr","dplyr","plyr","magrittr","purrr","data.table","plotrix","jtools","sp","GISTools","rgdal","sf","spatialEco","ggplot2","ggrepel")
lapply(paketit,library,character.only=T)
#model 1: data until 1999; model 2: full data
#mpred1: posterior mean based on model 1; mpred2: posterior mean based on model 2
samples = 1000
thin = 10
nChains = 4
modeltype = 1 #1 on pa-aineistolle
filename = file.path(PredictionDir, paste("predictions_",c("pa","abundance")[modeltype],
"_chains_",as.character(nChains),"_thin_", as.character(thin),"_samples_", as.character(samples),
".Rdata",sep = ""))
load(filename) #mpred1, mpred2, Y, studyDesign
routes=levels(studyDesign$Route)
nr=length(routes)
years=levels(studyDesign$Year)
dim(mpred1)
ns=dim(mpred1)[2]
dim(mpred2)
dim(Y)
dim(studyDesign)
period1=(studyDesign$Year=="Year_1996" | studyDesign$Year=="Year_1997" | studyDesign$Year=="Year_1998" | studyDesign$Year=="Year_1999")
period2=(studyDesign$Year=="Year_2013" | studyDesign$Year=="Year_2014" | studyDesign$Year=="Year_2015" | studyDesign$Year=="Year_2016")
pm1p1=mpred1[period1,]
pm2p1=mpred2[period1,]
pm1p2=mpred1[period2,] #pm1p2 = predictions by model 1 to period 2
pm2p2=mpred2[period2,]
y1=Y[period1,]
y2=Y[period2,]
sd1 = studyDesign[period1,]
sd2 = studyDesign[period2,]
visits1 = rep(NA,nr)
visits2 = rep(NA,nr)
for (i in 1:nr){
visits1[i] = sum(sd1$Route==routes[i])
visits2[i] = sum(sd2$Route==routes[i])
}
# COMPUTE MEASURES A AND B
selroutes = routes[which(visits2>=2)]  #periodi 2, joten vesilintujen NA:t eiv?t vaikuta n?iss? laskuissa
nsr = length(selroutes)
Ap1=matrix(NA,nrow = nsr,ncol = ns)
Ap2=matrix(NA,nrow = nsr,ncol = ns)
Ay=matrix(NA,nrow = nsr,ncol = ns)
for (i in 1:nsr){
take = which(sd2$Route == selroutes[i])
Ap1[i,] = colMeans(pm1p2[take,])
Ap2[i,] = colMeans(pm2p2[take,])
Ay[i,] = colMeans(y2[take,])
}
A = rep(NA,ns)
B = rep(NA,ns)
for (i in 1:ns){
A[i] = cor(Ap2[,i],Ay[,i])
B[i] = cor(Ap1[,i],Ay[,i])
}
plot(A,B) + abline(0,1)
## Reittikohtainen korrelaatio, kaikki lajit samanaikaisesti
selroutes1=as.data.frame(selroutes)
selroutes1$pa_corA=NA
selroutes1$pa_corB=NA
for(i in 1:nrow(Ap1)){
selroutes1$pa_corB[i]=cor(Ap1[i,],Ay[i,],use="na.or.complete")
}
for(i in 1:nrow(Ap2)){
selroutes1$pa_corA[i]=cor(Ap2[i,],Ay[i,],use="na.or.complete")
}
# COMPUTE MEASURES C AND D
selroutes = routes[which(visits1>=2 & visits2>=2)]
nsr = length(selroutes)
Ap1=matrix(NA,nrow = nsr,ncol = ns)
Ap2=matrix(NA,nrow = nsr,ncol = ns)
Ay=matrix(NA,nrow = nsr,ncol = ns)
for (i in 1:nsr){
take1 = which(sd1$Route == selroutes[i])
take2 = which(sd2$Route == selroutes[i])
Ap1[i,] = colMeans(pm1p2[take2,])-colMeans(pm1p1[take1,]) #ennusteisiin ei tule NA:ta mutta seuraavissa laskuissa havaintojen NA eliminoi ennusteissa olevat virheet
Ap2[i,] = colMeans(pm2p2[take2,])-colMeans(pm2p1[take1,])
Ay[i,] = colMeans(y2[take2,])- colMeans(y1[take1,])   #Suomen vesilintujen NA:t s?ilyv?t
}
C = rep(NA,ns)
D = rep(NA,ns)
for (i in 1:ns){
C[i] = cor(Ap2[,i],Ay[,i], use="na.or.complete")  #NA:t eiv?t est? korrelaation laskemista koko lajille
D[i] = cor(Ap1[,i],Ay[,i], use="na.or.complete")
}
plot(C,D) + abline(0,1)
View(Ap1)
View(studyDesign)
View(Y)
names(Y)
colnames(Y)
vp=as.data.frame(Ap2[,21])
View(vp)
View(Ap1)
View(Ap2)
vp_obs=Ay[,21]
viherpeippo=cbind(vp_pred,vp_obs)
vp_pred=Ap2[,21]
viherpeippo=cbind(vp_pred,vp_obs)
View(viherpeippo)
viherpeippo=as.data.frame(cbind(vp_pred,vp_obs))
View(viherpeippo)
meres=c(mean(A,na.rm = TRUE),mean(B,na.rm = TRUE),mean(C,na.rm = TRUE),mean(D,na.rm = TRUE))
names(meres)=c("A","B","C","D")
meres
species=colnames(Y)
pa_results=data.frame(species,A,B,C,D)
setnames(pa_results,c("A","B","C","D"),c("pa_A","pa_B","pa_C","pa_D"))
View(pa_results)
cor(vp_pred,vp_obs)
cor(vp_pred,vp_obs, use="na.or.complete")
vp_pred=Ap1[,21]
vp_obs=Ay[,21]
viherpeippo=as.data.frame(cbind(vp_pred,vp_obs))
cor(vp_pred,vp_obs, use="na.or.complete")
ggplot(viherpeippo, aes(x=vp_pred,y=vp_obs))+ geom_point()
ggplot(viherpeippo, aes(x=vp_pred,y=vp_obs))+ geom_point()+ xlim(-1,1)+ylim(-1,1)
ggplot(viherpeippo, aes(x=vp_pred,y=vp_obs))+ geom_point()+ xlim(-1,1)+ylim(-1,1)+ggtitle("Viherpeippo")
pred=Ap1[,21]
obs=Ay[,21]
laji=as.data.frame(cbind(pred,obs))
#tarkistus
cor(pred,obs, use="na.or.complete")
#kuvaaja
ggplot(laji, aes(x=pred,y=obs))+ geom_point()+ xlim(-1,1)+ylim(-1,1)+ggtitle("Viherpeippo")
ggplot(laji, aes(x=pred,y=obs))+ geom_point()+ xlim(-1,1)+ylim(-1,1)+ geom_abline(intercept = 0, slope =1)+ggtitle("Viherpeippo")
ggplot(laji, aes(x=pred,y=obs))+ geom_point()+ xlim(-1,1)+ylim(-1,1)+ geom_abline(intercept = 0, slope =1) + geom_hline(yintercept=0) + geom_vline(xintercept = 0) +ggtitle("Viherpeippo")
modeltype = 2 #2 on abu-aineistolle
filename = file.path(PredictionDir, paste("predictions_",c("pa","abundance")[modeltype],                                    "_chains_",as.character(nChains),"_thin_", as.character(thin),"_samples_", as.character(samples),".Rdata",sep = ""))
load(filename) #mpred1, mpred2, Y, studyDesign
routes=levels(studyDesign$Route)
nr=length(routes)
years=levels(studyDesign$Year)
dim(mpred1)
ns=dim(mpred1)[2]
dim(mpred2)
dim(Y)
dim(studyDesign)
pm1p1=mpred1[period1,]
pm2p1=mpred2[period1,]
pm1p2=mpred1[period2,] #pm1p2 = predictions by model 1 to period 2
pm2p2=mpred2[period2,]
y1=Y[period1,]
y2=Y[period2,]
sd1 = studyDesign[period1,]
sd2 = studyDesign[period2,]
visits1 = rep(NA,nr)
visits2 = rep(NA,nr)
for (i in 1:nr){
visits1[i] = sum(sd1$Route==routes[i])
visits2[i] = sum(sd2$Route==routes[i])
}
# COMPUTE MEASURES A AND B
selroutes = routes[which(visits2>=2)]
nsr = length(selroutes)
Ap1=matrix(NA,nrow = nsr,ncol = ns)
Ap2=matrix(NA,nrow = nsr,ncol = ns)
Ay=matrix(NA,nrow = nsr,ncol = ns)
for (j in 1:ns) {
for (i in 1:nsr){
take = which(sd2$Route == selroutes[i] & y2[,j]>-1)
Ap1[i,j] = mean(pm1p2[take,j])
Ap2[i,j] = mean(pm2p2[take,j])
Ay[i,j] = mean(y2[take,j],na.rm=T)
}}
A = rep(NA,ns)
B = rep(NA,ns)
for (i in 1:ns){
A[i] = cor(Ap2[,i],Ay[,i],use="na.or.complete")   #lis?sin t?h?n m??reen
B[i] = cor(Ap1[,i],Ay[,i],use="na.or.complete")
}
plot(A,B)+abline(0,1)
## Reittikohtainen korrelaatio, kaikki lajit samanaikaisesti
selroutes1=as.data.frame(selroutes)
selroutes1$abu_corA=NA
selroutes1$abu_corB=NA
for(i in 1:nrow(Ap1)){
selroutes1$abu_corB[i]=cor(Ap1[i,],Ay[i,],use="na.or.complete")
}
for(i in 1:nrow(Ap2)){
selroutes1$abu_corA[i]=cor(Ap2[i,],Ay[i,],use="na.or.complete")
}
# COMPUTE MEASURES C AND D
selroutes = routes[which(visits1>=2 & visits2>=2)]
nsr = length(selroutes)
Ap1=matrix(NA,nrow = nsr,ncol = ns)
Ap2=matrix(NA,nrow = nsr,ncol = ns)
Ay=matrix(NA,nrow = nsr,ncol = ns)
for (j in 1:ns){
for (i in 1:nsr){
take1 = which(sd1$Route == selroutes[i] & y1[,j]>-1)
take2 = which(sd2$Route == selroutes[i]& y2[,j]>-1)
Ap1[i,j] = mean(pm1p2[take2,j])-mean(pm1p1[take1,j]) #ka laskettava vain vuosilta, jolloin lajia on havaittu
Ap2[i,j] = mean(pm2p2[take2,j])-mean(pm2p1[take1,j]) #riitt??, ett? on edes kerran pystytty laskemaan lajia
Ay[i,j] = mean(y2[take2,j],na.rm=T)- mean(y1[take1,j],na.rm=T) #NA:t eiv?t saa est?? keskiarvon laskemista koko lajille.
}}
C = rep(NA,ns)
D = rep(NA,ns)
for (i in 1:ns){
C[i] = cor(Ap2[,i],Ay[,i],use="na.or.complete")    #lis?sin t?h?n m??reen
D[i] = cor(Ap1[,i],Ay[,i],use="na.or.complete")
}
plot(C,D)+abline(0,1)
meres=c(mean(A,na.rm = TRUE),mean(B,na.rm = TRUE),mean(C,na.rm = TRUE),mean(D,na.rm = TRUE))
names(meres)=c("A","B","C","D")
meres
#save as datatable
species=colnames(Y)
abu_results=data.frame(species,A,B,C,D)
setnames(abu_results,c("A","B","C","D"),c("abu_A","abu_B","abu_C","abu_D"))
write.csv(abu_results, "abu_results.csv",row.names = F)
#combine data frames
res=inner_join(pa_results,abu_results,by="species")
#save as csv for further analysis
write.csv(res,"results.csv",row.names = F)
pred=Ap1[,21]
obs=Ay[,21]
laji=as.data.frame(cbind(pred,obs))
#tarkistus
cor(pred,obs, use="na.or.complete")
#kuvaaja
ggplot(laji, aes(x=pred,y=obs))+ geom_point()+ xlim(-1,1)+ylim(-1,1)+ geom_abline(intercept = 0, slope =1) + geom_hline(yintercept=0) + geom_vline(xintercept = 0) +ggtitle("Viherpeippo")
View(abu_results)
cor(pred,obs, use="na.or.complete")
ggplot(laji, aes(x=pred,y=obs))+ geom_point()+ xlim(-1,1)+ylim(-1,1)+ geom_abline(intercept = 0, slope =1) + geom_hline(yintercept=0) + geom_vline(xintercept = 0) +ggtitle("Viherpeippo")
View(laji)
ggplot(laji, aes(x=pred,y=obs))+ geom_point()+ geom_abline(intercept = 0, slope =1) + geom_hline(yintercept=0) + geom_vline(xintercept = 0) +ggtitle("Viherpeippo")
ggplot(laji, aes(x=pred,y=obs))+ geom_point()+ xlim(-3,3)+ylim(-3,3)+ geom_abline(intercept = 0, slope =1) + geom_hline(yintercept=0) + geom_vline(xintercept = 0) +ggtitle("Viherpeippo")
ggplot(laji, aes(x=pred,y=obs))+ geom_point()+ xlim(-2,2)+ylim(-2,2)+ geom_abline(intercept = 0, slope =1) + geom_hline(yintercept=0) + geom_vline(xintercept = 0) +ggtitle("Viherpeippo")
log(1)
log(2)
log(1000)
log(9)
log(28)
log(100)
knitr::opts_chunk$set(echo = TRUE)
getwd()
localDir = "."
PredictionDir = file.path(localDir, "data")
paketit<-c("readr","tidyr","dplyr","plyr","magrittr","purrr","data.table","plotrix","jtools","sp","GISTools","rgdal","sf","spatialEco","ggplot2","ggrepel")
lapply(paketit,library,character.only=T)
#model 1: data until 1999; model 2: full data
#mpred1: posterior mean based on model 1; mpred2: posterior mean based on model 2
samples = 1000
thin = 10
nChains = 4
modeltype = 1 #1 on pa-aineistolle
filename = file.path(PredictionDir, paste("predictions_",c("pa","abundance")[modeltype],
"_chains_",as.character(nChains),"_thin_", as.character(thin),"_samples_", as.character(samples),
".Rdata",sep = ""))
load(filename) #mpred1, mpred2, Y, studyDesign
routes=levels(studyDesign$Route)
nr=length(routes)
years=levels(studyDesign$Year)
dim(mpred1)
ns=dim(mpred1)[2]
dim(mpred2)
dim(Y)
dim(studyDesign)
period1=(studyDesign$Year=="Year_1996" | studyDesign$Year=="Year_1997" | studyDesign$Year=="Year_1998" | studyDesign$Year=="Year_1999")
period2=(studyDesign$Year=="Year_2013" | studyDesign$Year=="Year_2014" | studyDesign$Year=="Year_2015" | studyDesign$Year=="Year_2016")
pm1p1=mpred1[period1,]
pm2p1=mpred2[period1,]
pm1p2=mpred1[period2,] #pm1p2 = predictions by model 1 to period 2
pm2p2=mpred2[period2,]
y1=Y[period1,]
y2=Y[period2,]
sd1 = studyDesign[period1,]
sd2 = studyDesign[period2,]
visits1 = rep(NA,nr)
visits2 = rep(NA,nr)
for (i in 1:nr){
visits1[i] = sum(sd1$Route==routes[i])
visits2[i] = sum(sd2$Route==routes[i])
}
# COMPUTE MEASURES A AND B
selroutes = routes[which(visits2>=2)]  #periodi 2, joten vesilintujen NA:t eiv?t vaikuta n?iss? laskuissa
nsr = length(selroutes)
Ap1=matrix(NA,nrow = nsr,ncol = ns)
Ap2=matrix(NA,nrow = nsr,ncol = ns)
Ay=matrix(NA,nrow = nsr,ncol = ns)
for (i in 1:nsr){
take = which(sd2$Route == selroutes[i])
Ap1[i,] = colMeans(pm1p2[take,])
Ap2[i,] = colMeans(pm2p2[take,])
Ay[i,] = colMeans(y2[take,])
}
A = rep(NA,ns)
B = rep(NA,ns)
for (i in 1:ns){
A[i] = cor(Ap2[,i],Ay[,i])
B[i] = cor(Ap1[,i],Ay[,i])
}
plot(A,B) + abline(0,1)
## Reittikohtainen korrelaatio, kaikki lajit samanaikaisesti
selroutes1=as.data.frame(selroutes)
selroutes1$pa_corA=NA
selroutes1$pa_corB=NA
for(i in 1:nrow(Ap1)){
selroutes1$pa_corB[i]=cor(Ap1[i,],Ay[i,],use="na.or.complete")
}
for(i in 1:nrow(Ap2)){
selroutes1$pa_corA[i]=cor(Ap2[i,],Ay[i,],use="na.or.complete")
}
# COMPUTE MEASURES C AND D
selroutes = routes[which(visits1>=2 & visits2>=2)]
nsr = length(selroutes)
Ap1=matrix(NA,nrow = nsr,ncol = ns)
Ap2=matrix(NA,nrow = nsr,ncol = ns)
Ay=matrix(NA,nrow = nsr,ncol = ns)
for (i in 1:nsr){
take1 = which(sd1$Route == selroutes[i])
take2 = which(sd2$Route == selroutes[i])
Ap1[i,] = colMeans(pm1p2[take2,])-colMeans(pm1p1[take1,]) #ennusteisiin ei tule NA:ta mutta seuraavissa laskuissa havaintojen NA eliminoi ennusteissa olevat virheet
Ap2[i,] = colMeans(pm2p2[take2,])-colMeans(pm2p1[take1,])
Ay[i,] = colMeans(y2[take2,])- colMeans(y1[take1,])   #Suomen vesilintujen NA:t s?ilyv?t
}
C = rep(NA,ns)
D = rep(NA,ns)
for (i in 1:ns){
C[i] = cor(Ap2[,i],Ay[,i], use="na.or.complete")  #NA:t eiv?t est? korrelaation laskemista koko lajille
D[i] = cor(Ap1[,i],Ay[,i], use="na.or.complete")
}
plot(C,D) + abline(0,1)
pred=Ap1[,21]
obs=Ay[,21]
laji=as.data.frame(cbind(pred,obs))
#tarkistus
cor(pred,obs, use="na.or.complete")
#kuvaaja
ggplot(laji, aes(x=pred,y=obs))+ geom_point()+ xlim(-1,1)+ylim(-1,1)+ geom_abline(intercept = 0, slope =1) + geom_hline(yintercept=0) + geom_vline(xintercept = 0) +ggtitle("Viherpeippo")
#create a table
meres=c(mean(A,na.rm = TRUE),mean(B,na.rm = TRUE),mean(C,na.rm = TRUE),mean(D,na.rm = TRUE))
names(meres)=c("A","B","C","D")
meres
#write.csv(meres,file="pa_species_specific_route_level.csv")
#save results as datatable for further analysis
species=colnames(Y)
pa_results=data.frame(species,A,B,C,D)
setnames(pa_results,c("A","B","C","D"),c("pa_A","pa_B","pa_C","pa_D"))
write.csv(pa_results, "pa_results.csv",row.names = F)
## metodit C ja D
selroutes2=as.data.frame(selroutes)
selroutes2$pa_corC=NA
selroutes2$pa_corD=NA
for(i in 1:nrow(Ap1)){
selroutes2$pa_corD[i]=cor(Ap1[i,],Ay[i,],use="na.or.complete")
}
for(i in 1:nrow(Ap2)){
selroutes2$pa_corC[i]=cor(Ap2[i,],Ay[i,],use="na.or.complete")
}
#collect all to one table
selroutes_pa<-left_join(selroutes1,selroutes2, by="selroutes")
colMeans(selroutes_pa[,2:5],na.rm = T)
View(selroutes_pa)
View(Ap1)
pred=Ap1[1,]
obs=Ay[1,]
laji=as.data.frame(rbind(pred,obs))
View(laji)
cor(pred,obs, use="na.or.complete")
View(selroutes_pa)
ggplot(laji, aes(x=pred,y=obs))+ geom_point()+ xlim(-1,1)+ylim(-1,1)+ geom_abline(intercept = 0, slope =1) + geom_hline(yintercept=0) + geom_vline(xintercept = 0) +ggtitle("Viherpeippo")
View(laji)
transpose(laji)
laji=transpose(laji)
laji=as.data.frame(rbind(pred,obs))
laji=transpose(laji)
pred=Ap1[1,]
obs=Ay[1,]
laji=as.data.frame(rbind(pred,obs))
#tarkistus
cor(pred,obs, use="na.or.complete")
#kuvaaja
laji=transpose(laji,make.names = c("pred","obs"))
laji=transpose(laji)
laji=rename(laji,V1=pred)
laji=rename(laji,pred=V1)
laji%%rename(laji,pred=V1)
laji%%rename(,pred=V1)
laji%>%rename(,pred=V1)
rename(laji,pred=V1)
library(dplyr)
rename(laji,pred=V1)
dplyr::rename(laji,pred=V1)
laji=dplyr::rename(laji,pred=V1)
laji=dplyr::rename(laji,c(pred=V1,obs=V2)
ggplot(laji, aes(x=pred,y=obs))+ geom_point()+ xlim(-1,1)+ylim(-1,1)+ geom_abline(intercept = 0, slope =1) + geom_hline(yintercept=0) + geom_vline(xintercept = 0) +ggtitle("Viherpeippo")
laji=dplyr::rename(laji,c(pred=V1,obs=V2))
laji=dplyr::rename(laji,pred=V1& obs=V2)
laji=dplyr::rename(laji, pred=V1)
laji=dplyr::rename(laji, obs=V2)
ggplot(laji, aes(x=pred,y=obs))+ geom_point()+ xlim(-1,1)+ylim(-1,1)+ geom_abline(intercept = 0, slope =1) + geom_hline(yintercept=0) + geom_vline(xintercept = 0) +ggtitle("Viherpeippo")
ggplot(laji, aes(x=pred,y=obs))+ geom_point()+ xlim(-1,1)+ylim(-1,1)+ geom_abline(intercept = 0, slope =1) + geom_hline(yintercept=0) + geom_vline(xintercept = 0) +ggtitle("reitti #106")
modeltype = 2 #2 on abu-aineistolle
filename = file.path(PredictionDir, paste("predictions_",c("pa","abundance")[modeltype],                                    "_chains_",as.character(nChains),"_thin_", as.character(thin),"_samples_", as.character(samples),".Rdata",sep = ""))
load(filename) #mpred1, mpred2, Y, studyDesign
routes=levels(studyDesign$Route)
nr=length(routes)
years=levels(studyDesign$Year)
dim(mpred1)
ns=dim(mpred1)[2]
dim(mpred2)
dim(Y)
dim(studyDesign)
# COMPUTE MEASURES A AND B
selroutes = routes[which(visits2>=2)]
nsr = length(selroutes)
Ap1=matrix(NA,nrow = nsr,ncol = ns)
Ap2=matrix(NA,nrow = nsr,ncol = ns)
Ay=matrix(NA,nrow = nsr,ncol = ns)
for (j in 1:ns) {
for (i in 1:nsr){
take = which(sd2$Route == selroutes[i] & y2[,j]>-1)
Ap1[i,j] = mean(pm1p2[take,j])
Ap2[i,j] = mean(pm2p2[take,j])
Ay[i,j] = mean(y2[take,j],na.rm=T)
}}
A = rep(NA,ns)
B = rep(NA,ns)
for (i in 1:ns){
A[i] = cor(Ap2[,i],Ay[,i],use="na.or.complete")   #lis?sin t?h?n m??reen
B[i] = cor(Ap1[,i],Ay[,i],use="na.or.complete")
}
plot(A,B)+abline(0,1)
## Reittikohtainen korrelaatio, kaikki lajit samanaikaisesti
selroutes1=as.data.frame(selroutes)
selroutes1$abu_corA=NA
selroutes1$abu_corB=NA
for(i in 1:nrow(Ap1)){
selroutes1$abu_corB[i]=cor(Ap1[i,],Ay[i,],use="na.or.complete")
}
for(i in 1:nrow(Ap2)){
selroutes1$abu_corA[i]=cor(Ap2[i,],Ay[i,],use="na.or.complete")
}
# COMPUTE MEASURES C AND D
selroutes = routes[which(visits1>=2 & visits2>=2)]
nsr = length(selroutes)
Ap1=matrix(NA,nrow = nsr,ncol = ns)
Ap2=matrix(NA,nrow = nsr,ncol = ns)
Ay=matrix(NA,nrow = nsr,ncol = ns)
for (j in 1:ns){
for (i in 1:nsr){
take1 = which(sd1$Route == selroutes[i] & y1[,j]>-1)
take2 = which(sd2$Route == selroutes[i]& y2[,j]>-1)
Ap1[i,j] = mean(pm1p2[take2,j])-mean(pm1p1[take1,j]) #ka laskettava vain vuosilta, jolloin lajia on havaittu
Ap2[i,j] = mean(pm2p2[take2,j])-mean(pm2p1[take1,j]) #riitt??, ett? on edes kerran pystytty laskemaan lajia
Ay[i,j] = mean(y2[take2,j],na.rm=T)- mean(y1[take1,j],na.rm=T) #NA:t eiv?t saa est?? keskiarvon laskemista koko lajille.
}}
C = rep(NA,ns)
D = rep(NA,ns)
for (i in 1:ns){
C[i] = cor(Ap2[,i],Ay[,i],use="na.or.complete")    #lis?sin t?h?n m??reen
D[i] = cor(Ap1[,i],Ay[,i],use="na.or.complete")
}
plot(C,D)+abline(0,1)
meres=c(mean(A,na.rm = TRUE),mean(B,na.rm = TRUE),mean(C,na.rm = TRUE),mean(D,na.rm = TRUE))
names(meres)=c("A","B","C","D")
meres
#save as datatable
species=colnames(Y)
abu_results=data.frame(species,A,B,C,D)
setnames(abu_results,c("A","B","C","D"),c("abu_A","abu_B","abu_C","abu_D"))
write.csv(abu_results, "abu_results.csv",row.names = F)
#combine data frames
res=inner_join(pa_results,abu_results,by="species")
#save as csv for further analysis
write.csv(res,"results.csv",row.names = F)
pred=Ap1[,21]
obs=Ay[,21]
laji=as.data.frame(cbind(pred,obs))
#tarkistus
cor(pred,obs, use="na.or.complete")
#kuvaaja
ggplot(laji, aes(x=pred,y=obs))+ geom_point()+ xlim(-2,2)+ylim(-2,2)+ geom_abline(intercept = 0, slope =1) + geom_hline(yintercept=0) + geom_vline(xintercept = 0) +ggtitle("Viherpeippo")
## Reittikohtainen korrelaatio, kaikki lajit samanaikaisesti
selroutes2=as.data.frame(selroutes)
selroutes2$abu_corC=NA
selroutes2$abu_corD=NA
for(i in 1:nrow(Ap1)){
selroutes2$abu_corD[i]=cor(Ap1[i,],Ay[i,],use="na.or.complete")
}
for(i in 1:nrow(Ap2)){
selroutes2$abu_corC[i]=cor(Ap2[i,],Ay[i,],use="na.or.complete")
}
#collect all to one table
selroutes_abu<-left_join(selroutes1,selroutes2, by="selroutes")
colMeans(selroutes_abu[,2:5],na.rm = T)
pred=Ap1[1,]
obs=Ay[1,]
laji=as.data.frame(rbind(pred,obs))
cor(pred,obs, use="na.or.complete")
View(selroutes_abu)
laji=transpose(laji)
laji=dplyr::rename(laji, pred=V1)
laji=dplyr::rename(laji, obs=V2)
ggplot(laji, aes(x=pred,y=obs))+ geom_point()+ xlim(-1,1)+ylim(-1,1)+ geom_abline(intercept = 0, slope =1) + geom_hline(yintercept=0) + geom_vline(xintercept = 0) +ggtitle("reitti #106")
