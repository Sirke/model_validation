#    theme_bw() +
#    theme(legend.justification=c(1,1),
#          legend.position=c(0.3,0.95),
#          legend.box.background=element_rect())  +             # Position legend in bottom right
#    theme(text = element_text(size = 17)) +
#    labs(fill = "Data type")
ggplot(stat, aes(y=accuracy, x=method,shape=Data_type)) + geom_errorbar(aes(ymin=accuracy-ci, ymax=accuracy+ci), colour="black", width=.2, position=pd) +ylab("Prediction accuracy") +
xlab("Validation method") +
theme_bw() +
theme(legend.justification=c(1,1),
legend.position=c(0.3,0.95),
legend.box.background=element_rect())  +
theme(text = element_text(size = 20)) +
geom_point(position=pd, size=4) +  scale_shape_discrete(name = "Data type", labels = c("abu", "POC")) + scale_shape_manual(values=c(17,19))
ggsave("plot2_allmethods_simple.png")
ggplot(stat, aes(y=accuracy, x=method,shape=Data_type)) +
geom_errorbar(aes(ymin=accuracy-ci, ymax=accuracy+ci), colour="black", width=.2, position=pd) +
ylab("Prediction accuracy") +
xlab("Validation method") +
theme_bw() +
theme(legend.justification=c(1,1),
legend.position=c(0.23,0.95),
legend.box.background=element_rect())  +
theme(text = element_text(size = 15)) +
geom_point(position=pd, size=4) +
scale_shape_discrete(name = "Data type", labels = c("abundance", "occurrence")) + geom_hline(yintercept = 0, linetype="dashed")+
geom_point(data=res2,position=pd, alpha=0.08)
ggsave("plot2_allmethods_alpha.png")
ggplot(stat, aes(y=accuracy, x=method,shape=Data_type)) +
geom_errorbar(aes(ymin=accuracy-ci, ymax=accuracy+ci), colour="black", width=.2, position=pd) +
ylab("Prediction accuracy") +
xlab("Validation method") +
theme_bw() +
theme(legend.justification=c(1,1),
legend.position=c(0.23,0.30),
legend.box.background=element_rect())  +
theme(text = element_text(size = 15)) +
geom_point(position=pd, size=4) +
scale_shape_discrete(name = "Data type", labels = c("abundance", "occurrence")) + geom_hline(yintercept = 0, linetype="dashed")+
geom_point(data=res2,position=pd, size=0.5)
ggsave("plot2_allmethods_noalpha.png")
stat <- summarySE(poolres, measurevar="accuracy", groupvars=c("method","pa","pool"),na.rm = T)
stat
stat$lower=stat$accuracy-stat$ci
stat$upper=stat$accuracy+stat$ci
#names(stat)[2] <- "Data_type"
#names(stat)[3] <- "Spatial_scale"
#stat$pool=revalue(stat$pool, c("NPo"="non-pooled", "Po"="pooled"))
knitr::kable(stat)
#names(res2)[4] <- "Data_type"
pd <- position_dodge(0.4) # move them .05 to the left and right
# Black error bars - notice the mapping of 'group=supp' -- without it, the error
# bars won't be dodged!
#levels(stat$pa) <- c("pa", "abu")
#levels(poolres$pa) <- c("pa", "abu")
poolres$pa=revalue(poolres$pa, c("pa"="occurrence", "abu"="abundance"))
stat$pa=revalue(stat$pa, c("pa"="occurrence", "abu"="abundance"))
stat$pool=revalue(stat$pool, c("NPo"="non-pooled", "Po"="pooled"))
stat$pa=factor(stat$pa, levels=c("occurrence","abundance"))
ggplot(stat, aes(y=accuracy, x=method, group=pool)) +
geom_point(aes(shape=pool),position=pd,size=2.5)  +
scale_shape_manual(values=c(19,17),name = "Spatial scale") +
geom_errorbar(aes(ymin=accuracy-ci, ymax=accuracy+ci), colour="black", width=.4, position=pd) +
ylab("Prediction accuracy") +
xlab("Validation method") +
theme_bw() +
theme(legend.justification=c(1,1),
legend.box.background=element_rect()) +
theme(text = element_text(size = 15)) +
geom_point(data=poolres,position=pd, size=0.5) +
facet_grid(.~pa) +
geom_hline(yintercept = 0, linetype="dashed") +
theme(legend.title = element_text(colour="black", size=10,
face="bold")) +
theme(legend.text = element_text(colour="black", size=10,
face="bold"))
ggsave("plot3_pa_pool_method.png")
poolres %>%
group_by(method,pa,pool) %>%
summarise(means=mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
#tarkistellaan taulukkona
poolres %>%
poolres %>%
group_by(method,pa,pool) %>%
summarise_at(vars(accuracy),list(~mean(., na.rm=T),std.errors=std.error(accuracy,na.rm=T))
1
poolres %>%
group_by(method,pa,pool) %>%
summarise_at(vars(accuracy),list(~mean(., na.rm=T),std.errors=std.error(accuracy,na.rm=T))
View(poolres)
View(poolres)
poolres %>%
group_by(species,method,pa,pool) %>%
summarise(means=mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
poolres %>%
group_by(species,method,pa,pool)
#tarkistellaan taulukkona
poolres %>%
group_by(species) %>%
summarise(means=mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
poolres %>%
group_by(species)
poolres %>%
group_by(species) %>%
summarise(means=mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
poolres %>%
group_by(method) %>%
summarise(means=mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
poolres %>%
group_by(pool) %>%
summarise(means=mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
#tarkistellaan taulukkona
by_species = poolres %>% group_by(species) %>%
summarise(means=mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
#tarkistellaan taulukkona
by_species = poolres %>% group_by(species) %>%
means =   by_species %>% summarise(mean = mean())
#tarkistellaan taulukkona
by_species = poolres %>% group_by(species)
means =   by_species %>% summarise(mean = mean())
by_species
by_species
#tarkistellaan taulukkona
by_species = poolres %>% group_by(pa)
by_species
by_species%>% summarise(
mean = mean(accuracy))
by_species%>% summarise(
mean = mean(accuracy,na.rm=T))
#tarkistellaan taulukkona
by_pa = poolres %>% group_by(pool)
by_pa%>% summarise(
mean = mean(accuracy,na.rm=T))
#tarkistellaan taulukkona
by_pa = poolres %>% dplyr::group_by(pool)
by_pa%>% summarise(
mean = mean(accuracy,na.rm=T))
by_pa%>% dplyr::summarise(
mean = mean(accuracy,na.rm=T))
by_pa%>% dplyr::summarise(
mean = mean(accuracy,na.rm=T))
poolres %>%
group_by(pool) %>%
summarise(mean = mean(accuracy), n = n())
poolres %>%
group_by(pool) %>%
summarise(mean = mean(accuracy))
poolres %>%
group_by(pool) %>%
summarise(mean = mean(accuracy,na.rm=T))
#tarkistellaan taulukkona
poolres %>%
group_by(method, pa, pool) %>%
summarise(mean = mean(accuracy,na.rm=T))
#tarkistellaan taulukkona
res2 %>%
group_by(method, pa) %>%
summarise(mean = mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
#tarkistellaan taulukkona
res2 %>%
group_by(method, Data_type) %>%
summarise(mean = mean(accuracy,na.rm=T),std.errors=std.error(accuracy,na.rm=T))
#lopullinen malli
mfinal=lme(accuracy~method,data=poolresPA,random=~1|species,method="REML",na.action="na.exclude")
summary(mfinal)
#validointi
plot(mfinal)
E1=resid(mfinal, type="normalized")
F1=fitted(mfinal)
par(mfrow=c(2,2), mar=c(5,5,2,2))
plot(x=F1,y=E1,xlab="fitted",ylab="residuals")
abline(h=0,lty=2)
boxplot(E1~method,xlab="method",ylab="residuals",data=res3)
#validointi
plot(mfinal)
E1=resid(mfinal, type="normalized")
F1=fitted(mfinal)
par(mfrow=c(2,2), mar=c(5,5,2,2))
plot(x=F1,y=E1,xlab="fitted",ylab="residuals")
abline(h=0,lty=2)
boxplot(E1~method,xlab="method",ylab="residuals",data=poolresPA)
abline(h=0,lty=2)
boxplot(E1~pa,xlab="pa",ylab="residuals",data=poolresPA)
abline(h=0,lty=2)
par(mfrow=c(1,1), mar=c(5,5,2,2))
boxplot(E1~species,xlab="species",ylab="residuals",data=poolresPA)
abline(h=0,lty=2)
#lopullinen malli
mfinal=lme(accuracy~method*pool,data=poolresABU,random=~1|species,method="REML",na.action="na.exclude")
summary(mfinal)
#validointi
plot(mfinal)
E1=resid(mfinal, type="normalized")
F1=fitted(mfinal)
par(mfrow=c(2,2), mar=c(5,5,2,2))
plot(x=F1,y=E1,xlab="fitted",ylab="residuals")
abline(h=0,lty=2)
boxplot(E1~method,xlab="method",ylab="residuals",data=poolresABU)
abline(h=0,lty=2)
par(mfrow=c(1,1), mar=c(5,5,2,2))
boxplot(E1~species,xlab="species",ylab="residuals",data=poolresABU)
abline(h=0,lty=2)
#lopullinen malli
mfinal=lme(accuracy~method,data=poolresPA,random=~1|species,method="REML",na.action="na.exclude")
summary(mfinal)
#validointi
plot(mfinal)
E1=resid(mfinal, type="normalized")
F1=fitted(mfinal)
par(mfrow=c(2,2), mar=c(5,5,2,2))
plot(x=F1,y=E1,xlab="fitted",ylab="residuals")
abline(h=0,lty=2)
boxplot(E1~method,xlab="method",ylab="residuals",data=poolresPA)
abline(h=0,lty=2)
par(mfrow=c(1,1), mar=c(5,5,2,2))
boxplot(E1~species,xlab="species",ylab="residuals",data=poolresPA)
abline(h=0,lty=2)
knitr::opts_chunk$set(echo = TRUE)
getwd()
paketit<-c("visreg","nlme","readr","tidyr","dplyr","plyr","magrittr","purrr","ggplot2","ape","geiger","MuMIn","psych","Hmisc")
lapply(paketit,library,character.only=T)
#aineiston valinta, leväyttäminen ja uudelleen nimeäminen
poolres<-read.csv("poolres.csv")
#lisätään lajiominaisuudet taulukkoon
traits<-read.csv("traits_table.csv",sep = ";")
results<-inner_join(poolres,traits,by="species")
str(results)
#uusi muuttuja, massan logaritmi
results$logmass<-log(results$Mass)
#uusi muuttuja, log-muunnettu prevalenssi
results$PrevS=log(results$Prev)
#jaetaan aineisto pa ja abu aineistoihin
resPA=subset(results,pa=="pa")
resABU=subset(results,pa=="abu")
#pa aineisto
ggplot(resPA, aes(x=Hab, y=accuracy)) +
geom_boxplot(aes(fill=method))+ facet_grid(. ~pool ) +
ggtitle("occurrence data")
ggplot(resABU, aes(x=Hab, y=accuracy)) +
geom_boxplot(aes(fill=method))+ facet_grid(. ~pool ) +
ggtitle("abundance data")
#pa aineisto
ggplot(resPA, aes(x=Mig, y=accuracy)) +
geom_boxplot(aes(fill=method))+ facet_grid(. ~pool ) +
ggtitle("occurrence data")
ggplot(resABU, aes(x=Mig, y=accuracy)) +
geom_boxplot(aes(fill=method))+ facet_grid(. ~pool ) +
ggtitle("abundance data")
#pa aineisto
ggplot(resPA, aes(x=PrevS, y=accuracy,shape=method)) +
geom_point () +
geom_smooth(method=lm) +
ggtitle("occurrence data") +
facet_grid(. ~pool)
#pa aineisto
ggplot(resPA, aes(x=PrevS, y=accuracy,color=method)) +
geom_point () +
geom_smooth(method=lm) +
ggtitle("occurrence data") +
facet_grid(. ~pool)
ggplot(resABU, aes(x=PrevS, y=accuracy,color=method)) +
geom_point()+
geom_smooth(method=lm) +
facet_grid(. ~pool ) +
ggtitle("abundance data")
#pa aineisto
ggplot(resPA, aes(x=logmass, y=accuracy,color=method)) +
geom_point () +
geom_smooth(method=lm) +
ggtitle("occurrence data") +
facet_grid(. ~pool)
#abu
ggplot(resABU, aes(x=logmass, y=accuracy,color=method)) +
geom_point()+
geom_smooth(method=lm) +
facet_grid(. ~pool ) +
ggtitle("abundance data")
cor(results$logmass,results$PrevS)
pairs(results[8:9])
View(results)
#luodaan eri mallivaihtoehtoja
malli0 <- gls(accuracy ~ 1, data = resPA,correlation=bm.birds,method="ML")
#luetaan aineisto sisään, Multiphylo eli monta puuta
linnut <- read.nexus("output.nex")
#valitaan vain yksi puu, mikä tahansa sadasta
linnut2<-linnut[[99]]
#define a variance-covariance structure based on the model of Brownian evolution
bm.birds=corBrownian(1,phy=linnut2)
#tehdään fylogenialistasta matriisi
lintupuu<-vcv.phylo(linnut2)
#matriisin voi värittää havainnollistamaan lintulajien sukulaisuutta
heatmap(lintupuu,Rowv = NA,Colv = NA)
#abu-aineistoa varten pari lajia pois, muuten koodi ei toimi
linnut3=drop.tip(linnut2, "Emberiza_rustica", trim.internal = TRUE, subtree = FALSE,
root.edge = 0, rooted = is.rooted(linnut2), collapse.singles = TRUE,
interactive = FALSE)
linnut4=drop.tip(linnut3, "Bonasa_bonasia", trim.internal = TRUE, subtree = FALSE,
root.edge = 0, rooted = is.rooted(linnut2), collapse.singles = TRUE,
interactive = FALSE)
bm.birds2=corBrownian(1,phy=linnut4)
#aineiston rivien nimet muutetaan lattareiksi jolloin keskustelee fylogeniapuun kanssa
rownames(results)=results$species
results$species=as.factor(results$species)
#uusi muuttuja, massan logaritmi
results$logmass<-log(results$Mass)
#uusi muuttuja, log-muunnettu prevalenssi
results$PrevS=log(results$Prev)
#tallenna tarvittaessa omaksi taulukokseen
#write.csv(results,"accuracies_traits.csv",row.names = F)
rownames(resPA)
#aineiston rivien nimet muutetaan lattareiksi jolloin keskustelee fylogeniapuun kanssa
rownames(resPA)=resPA$species
View(resPA)
#luodaan eri mallivaihtoehtoja
malli0 <- gls(accuracy ~ 1, data = resPA,correlation=bm.birds,method="ML") #pa-aineistolle bm.birds
library(ape)
library(MCMCglmm)
getwd()
paketit<-c("visreg","nlme","readr","tidyr","dplyr","plyr","magrittr","purrr","ggplot2","ape","geiger","MuMIn","psych","Hmisc","MCMCglmm")
lapply(paketit,library,character.only=T)
paketit<-c("visreg","nlme","readr","tidyr","plyr","dplyr","magrittr","purrr","ggplot2","ape","geiger","MuMIn","psych","Hmisc","MCMCglmm")
lapply(paketit,library,character.only=T)
#aineiston valinta, leväyttäminen ja uudelleen nimeäminen
poolres<-read.csv("poolres.csv")
#lisätään lajiominaisuudet taulukkoon
traits<-read.csv("traits_table.csv",sep = ";")
results<-inner_join(poolres,traits,by="species")
str(results)
results$species=as.factor(results$species)
#uusi muuttuja, massan logaritmi
results$logmass<-log(results$Mass)
#uusi muuttuja, log-muunnettu prevalenssi
results$PrevS=log(results$Prev)
#arcsin-muunnos (kokeiltu)
#asinTransform <- function(p) { asin(sqrt(p)) }
#results$PrevS=asinTransform(results$Prev)
#logit-muunnos (kokeilin, antaa ihan samanlaiset residuaalit)
#logitTransform <- function(p) { log(p/(1-p)) }
#results$PrevS=logitTransform(results$Prev)
#tallenna tarvittaessa omaksi taulukokseen
#write.csv(results,"accuracies_traits.csv",row.names = F)
#jaetaan aineisto pa ja abu aineistoihin
resPA=subset(results,pa=="pa")
resABU=subset(results,pa=="abu")
#pa aineisto
ggplot(resPA, aes(x=Hab, y=accuracy)) +
geom_boxplot(aes(fill=method)) + facet_grid(. ~pool ) +
ggtitle("occurrence data")
ggplot(resABU, aes(x=Hab, y=accuracy)) +
geom_boxplot(aes(fill=method)) + facet_grid(. ~pool ) +
ggtitle("abundance data")
#luetaan aineisto sisään, Multiphylo eli monta puuta
linnut <- read.nexus("output.nex")
#valitaan vain yksi puu, mikä tahansa sadasta
linnut2<-linnut[[99]]
#define a variance-covariance structure based on the model of Brownian evolution
bm.birds=corBrownian(1,phy=linnut2)
#tehdään fylogenialistasta matriisi
lintupuu<-vcv.phylo(linnut2)
#matriisin voi värittää havainnollistamaan lintulajien sukulaisuutta
heatmap(lintupuu,Rowv = NA,Colv = NA)
#abu-aineistoa varten pari lajia pois, muuten koodi ei toimi
linnut3=drop.tip(linnut2, "Emberiza_rustica", trim.internal = TRUE, subtree = FALSE,
root.edge = 0, rooted = is.rooted(linnut2), collapse.singles = TRUE,
interactive = FALSE)
linnut4=drop.tip(linnut3, "Bonasa_bonasia", trim.internal = TRUE, subtree = FALSE,
root.edge = 0, rooted = is.rooted(linnut2), collapse.singles = TRUE,
interactive = FALSE)
bm.birds2=corBrownian(1,phy=linnut4)
#aineiston rivien nimet muutetaan lattareiksi jolloin keskustelee fylogeniapuun kanssa
rownames(resPA)=resPA$species
m20<- MCMCglmm(accuracy ~ logmass*method + pool, random=~species, data = resPA,family="gaussian",ginverse=list(species=Ainv1),nitt=103000, burnin=300, thin=100)
m20<- MCMCglmm(accuracy ~ logmass*method + pool, random=~species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=103000, burnin=300, thin=100)
#luetaan aineisto sisään, Multiphylo eli monta puuta
linnut <- read.nexus("output.nex")
#valitaan vain yksi puu, mikä tahansa sadasta
linnut2<-linnut[[99]]
#define a variance-covariance structure based on the model of Brownian evolution
bm.birds=corBrownian(1,phy=linnut2)
bm.birds
m20<- MCMCglmm(accuracy ~ logmass*method + pool, random=~species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=103000, burnin=300, thin=100)
View(lintupuu)
phylo1=read.tree(linnut2)
Ainv1<-inverseA(linnut2)$Ainv
bm.birds<-inverseA(linnut2)$Ainv
m20<- MCMCglmm(accuracy ~ logmass*method + pool, random=~species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=103000, burnin=300, thin=100)
summary(m20)
plot(m20$Sol, auto.layout=F)
summary(m20)
plot(m20$Sol, auto.layout=F)
m18<- MCMCglmm(accuracy ~ PrevS*method + pool, random=~species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=103000, burnin=300, thin=100)
m18<- MCMCglmm(accuracy ~ PrevS*method + pool, random=~species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=103000, burnin=300, thin=100)
m19<- MCMCglmm(accuracy ~ Mig*method  + pool, random=~species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=103000, burnin=300, thin=100)
output0=model.sel(m20,m19,m18)
output0
prior<-list(R=list(V=1, nu=0.00), G=list(G1=list(V=1, nu=0.00)))
m1<- MCMCglmm(accuracy ~ Hab*method*pool + PrevS*method*pool + Mig*method*pool + logmass*method*pool, random=~species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m1<- MCMCglmm(accuracy ~ Hab*method*pool + PrevS*method*pool + Mig*method*pool + logmass*method*pool, random=~species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m2<- MCMCglmm(accuracy ~ Hab*method + Hab*pool +PrevS*method + PrevS*pool + Mig*method + Mig*pool + logmass*method + logmass*pool, random=~ species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
output0=model.sel(m1,m2)
output0
m3<- MCMCglmm(accuracy~ Hab*method +PrevS*method + Mig*method + logmass*method + pool, random=~species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m3<- MCMCglmm(accuracy~ Hab*method +PrevS*method + Mig*method + logmass*method + pool, random=~species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m4<- MCMCglmm(accuracy ~ Hab*pool +PrevS*pool + Mig*pool + logmass*pool + method, random=~species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m5<- MCMCglmm(accuracy ~ Hab + PrevS + Mig + logmass + method + pool, random=~species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m6<- MCMCglmm(accuracy ~ Hab*method +PrevS*method + Mig*method + logmass*method + pool, random=~species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m7<- MCMCglmm(accuracy ~ Hab*method +PrevS*method + Mig*method  + pool, random=~species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m8<- MCMCglmm(accuracy ~ Hab*method +PrevS*method  + logmass*method + pool, random=~species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m9<- MCMCglmm(accuracy ~ Hab*method + Mig*method + logmass*method + pool, random=~species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m10<- MCMCglmm(accuracy ~ Prev*method + Mig*method + logmass*method + pool, random=~species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m11<- MCMCglmm(accuracy ~ Hab*method +PrevS*method + pool, random=~species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m12<- MCMCglmm(accuracy ~ Hab*method + Mig*method  + pool, random=~species, data =
resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m13<- MCMCglmm(accuracy ~ Hab*method + logmass*method + pool, random=~species, data=      resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m14<- MCMCglmm(accuracy ~ PrevS*method + Mig*method  + pool, random=~species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m15<- MCMCglmm(accuracy ~ PrevS*method +  logmass*method + pool, random=~species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m16<- MCMCglmm(accuracy ~ Mig*method + logmass*method + pool, random=~species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m17<- MCMCglmm(accuracy ~ Hab*method + pool, random=~sp2, data = resPA,family="gaussian",ginverse=list(sp2=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m17<- MCMCglmm(accuracy ~ Hab*method + pool, random=~sp2, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m17<- MCMCglmm(accuracy ~ Hab*method + pool, random=~species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m17<- MCMCglmm(accuracy ~ Hab*method + pool, random=~species, data = resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
#mallin valintaa MuMin paketin avulla
output1<-model.sel(m1,m2,m3,m4,m5,m6,m7,m8,m9,m10,m11,m12,m13,m14,m15,m16,m17,m18,m19,m20)
output1
knitr::opts_chunk$set(echo = TRUE)
getwd()
paketit<-c("visreg","nlme","readr","tidyr","plyr","dplyr","magrittr","purrr","ggplot2","ape","geiger","MuMIn","psych","Hmisc","MCMCglmm")
lapply(paketit,library,character.only=T)
#luetaan aineisto sisään, Multiphylo eli monta puuta
linnut <- read.nexus("output.nex")
#valitaan vain yksi puu, mikä tahansa sadasta
linnut2<-linnut[[99]]
#tehdään puusta malliin sopiva fylogeniarakenne
phylo1=read.tree(linnut2)
#valitaan vain yksi puu, mikä tahansa sadasta
linnut2<-linnut[[99]]
#tehdään puusta malliin sopiva fylogeniarakenne
phylo1=read.tree(linnut2)
bm.birds<-inverseA(linnut2)$Ainv
#abu-aineistoa varten pari lajia pois, muuten koodi ei toimi
linnut3=drop.tip(linnut2, "Emberiza_rustica", trim.internal = TRUE, subtree = FALSE,
root.edge = 0, rooted = is.rooted(linnut2), collapse.singles = TRUE,
interactive = FALSE)
linnut4=drop.tip(linnut3, "Bonasa_bonasia", trim.internal = TRUE, subtree = FALSE,
root.edge = 0, rooted = is.rooted(linnut2), collapse.singles = TRUE,
interactive = FALSE)
bm.birds2<-inverseA(linnut4)$Ainv
m20A<- MCMCglmm(accuracy ~ logmass*method + pool, random=~species, data = resABU,family="gaussian",ginverse=list(species=bm.birds),nitt=103000, burnin=300, thin=100)
summary(m20A)
m1A<- MCMCglmm(accuracy ~ Hab*method*pool + PrevS*method*pool + Mig*method*pool + logmass*method*pool, random=~species, data = resABU,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m2A<- MCMCglmm(accuracy ~ Hab*method + Hab*pool +PrevS*method + PrevS*pool + Mig*method + Mig*pool + logmass*method + logmass*pool, random=~ species, data = resABU,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m3A<- MCMCglmm(accuracy~ Hab*method +PrevS*method + Mig*method + logmass*method + pool, random=~species, data = resABU,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m4A<- MCMCglmm(accuracy ~ Hab*pool +PrevS*pool + Mig*pool + logmass*pool + method, random=~species, data = resABU,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m5A<- MCMCglmm(accuracy ~ Hab + PrevS + Mig + logmass + method + pool, random=~species, data = resABU,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m6A<- MCMCglmm(accuracy ~ Hab*method +PrevS*method + Mig*method + logmass*method + pool, random=~species, data = resABU,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m7A<- MCMCglmm(accuracy ~ Hab*method +PrevS*method + Mig*method  + pool, random=~species, data = resABU,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m8A<- MCMCglmm(accuracy ~ Hab*method +PrevS*method  + logmass*method + pool, random=~species, data = resABU,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m9A<- MCMCglmm(accuracy ~ Hab*method + Mig*method + logmass*method + pool, random=~species, data = resABU,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m10A<- MCMCglmm(accuracy ~ Prev*method + Mig*method + logmass*method + pool, random=~species, data = resABU,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m11A<- MCMCglmm(accuracy ~ Hab*method +PrevS*method + pool, random=~species, data = resABU,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m12A<- MCMCglmm(accuracy ~ Hab*method + Mig*method  + pool, random=~species, data =
resABU,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m13A<- MCMCglmm(accuracy ~ Hab*method + logmass*method + pool, random=~species, data=      resABU,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m14A<- MCMCglmm(accuracy ~ PrevS*method + Mig*method  + pool, random=~species, data = resABU,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m15A<- MCMCglmm(accuracy ~ PrevS*method +  logmass*method + pool, random=~species, data = resABU,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m16A<- MCMCglmm(accuracy ~ Mig*method + logmass*method + pool, random=~species, data = resABU,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m17A<- MCMCglmm(accuracy ~ Hab*method + pool, random=~species, data = resABU,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m18A<- MCMCglmm(accuracy ~ PrevS*method + pool, random=~species, data = resABU,family="gaussian",ginverse=list(species=bm.birds),nitt=103000, burnin=300, thin=100)
m19A<- MCMCglmm(accuracy ~ Mig*method  + pool, random=~species, data = resABU,family="gaussian",ginverse=list(species=bm.birds),nitt=103000, burnin=300, thin=100)
m20A<- MCMCglmm(accuracy ~ logmass*method + pool, random=~species, data = resABU,family="gaussian",ginverse=list(species=bm.birds),nitt=103000, burnin=300, thin=100)
summary(m20A)
plot(m20A$Sol, auto.layout=F)
#mallin valintaa MuMin paketin avulla
output1<-model.sel(m1A,m2A,m3A,m4A,m5A,m6A,m7A,m8A,m9A,m10A,m11A,m12A,m13A,m14A,m15A,m16A,m17A,m18A,m19A,m20A)
output1
output0=model.sel(m1A,m2A)
output0
output1<-model.sel(m1,m2,m3,m4,m5,m6,m7,m8,m9,m10,m11,m12,m13,m14,m15,m16,m17,m18,m19,m20)
output1
output0=model.sel(m1,m2)
output0
#mitä jos tiputtaisi vielä poolauksen?
m21<- MCMCglmm(accuracy ~ Hab*method + Mig*method , random=~species, data =
resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
output0=model.sel(m12,m21)
output0
output2=model.sel(m12,m21)
output2
summary(m21)
plot(m21$Sol, auto.layout=F)
summary(m21)
plot(m21$Sol, auto.layout=F)
#mallin valintaa MuMin paketin avulla
output1<-model.sel(m1,m2,m3,m4,m5,m6,m7,m8,m9,m10,m11,m12,m13,m14,m15,m16,m17,m18,m19,m20)
output1
#mitä jos tiputtaisi vielä poolauksen?
m22<- MCMCglmm(accuracy ~ Hab + method + Mig , random=~species, data =
resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
output3=model.sel(m21,m22)
output3
#mitä jos tiputtaisi vielä poolauksen?
m22<- MCMCglmm(accuracy ~ Hab*method + Mig , random=~species, data =
resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
m23<- MCMCglmm(accuracy ~ Hab + method*Mig , random=~species, data =
resPA,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
output3=model.sel(m21,m22,m23)
output3
#mallin valintaa MuMin paketin avulla
output4<-model.sel(m1A,m2A,m3A,m4A,m5A,m6A,m7A,m8A,m9A,m10A,m11A,m12A,m13A,m14A,m15A,m16A,m17A,m18A,m19A,m20A)
output4
summary(m10A)
m21A<- MCMCglmm(accuracy ~ Prev*method + Mig*method + logmass*method + pool, random=~species, data = resABU,family="gaussian",ginverse=list(species=bm.birds),nitt=1003000, burnin=3000, thin=1000)
