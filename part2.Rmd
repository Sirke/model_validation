---
title: "Comparing validation methods"
author: "me"
date: "4 joulukuuta 2019"
output: html_document
---
# Comparing validation methods

Verrataan neljällä eri metodilla laskettuja ennustustarkkuuksia. 

```{r , include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
packages<-c("readr","tidyr","dplyr","plyr","magrittr","purrr","data.table","plotrix","jtools")
lapply(packages,library,character.only=T)
```

```{r }
getwd()
res<-read.csv("results.csv",header=T,sep=",")
```

## Lajikohtaiset ennustustarkkuudet

### Keskiarvot

```{r }
#Compute means and standard errors
res %>% dplyr::select(2:9)%>%colMeans()
res %>% dplyr::select(2:9)%>%std.error()

#kuvaaja
boxplot(res[-1])
```

Kuvaajissa olisi varmaan hyvä pitää pa ja abu erillään?


### Onko metodien välillä eroja?

Jaetaan aineisto pa ja abu-aineistoihin ja selvitetään, vaikuttavatko validointimetodi tai laji ennustustarkkuuteen. Selvitetään myös, mitkä metodit eroavat toisistaan.

#### pa 

```{r }
#pa
res_pa=res[,1:5]
res_pa=gather(res_pa,"method","accuracy",2:5)
res_pa$method=as.factor(res_pa$method)
summary(res_pa)

#two-way anova
anova(lm(res_pa$accuracy~res_pa$method+res_pa$species))

#pairwise comparisons, bonferroni correction for multiple testing
pairwise.t.test(res_pa$accuracy, res_pa$method, p.adj="bonferroni")
```

Validointimetodi ja laji vaikuttavat ennustustarkkuuteen. Metodit A ja B eroavat metodeista C ja D. 

#### abu

```{r }
#abu
res_abu=res[,c(1,6:9)]
res_abu=gather(res_abu,"method","accuracy",2:5)
res_abu$method=as.factor(res_abu$method)
summary(res_abu)


#two-way anova
anova(lm(res_abu$accuracy~res_abu$method+res_abu$species))

#pairwise comparisons, bonferroni correction for multiple testing
pairwise.t.test(res_abu$accuracy, res_abu$method, p.adj="bonferroni")

```

Sama tulos.


### Onko pa ja abu -aineistojen välillä eroja?

Onko helpompi ennustaa esiintymistodennäköisyyttä vai runsautta?  

Voiko tällaista vertailua tehdä?

#### metodi A

```{r }
#A pa ja abu välillä
t.test(res$pa_A,res$abu_A, paired=TRUE)
```

#### metodi B

```{r }
#B pa ja abu välillä
t.test(res$pa_B,res$abu_B, paired=TRUE)
```

#### metodi C

```{r }
#change pa ja abu välillä
t.test(res$pa_C,res$abu_C, paired=TRUE)
```

#### metodi D
```{r }
#change pa ja abu välillä
t.test(res$pa_D,res$abu_D, paired=TRUE)
```

Vain metodi D tekee eroa pa ja abu-aineistojen välille. Pa-aineiston ennustustarkkuudet ovat hitusen verran paremmat.

### Kuvaaja

Tätä pitäisi vielä miettiä, mitä plotataan ja mitä vasten? Alun perin verrattiin metodi D:tä pa/abu_past-arvoihin eli vähän sama kuin vertailu metodi A:han. siis, voitaisiinko jo hyvin yksinkertaisella validointimenetelmällä saada samoja tuloksia kuin monimutkaisemmalla metodilla?

```{r, fig.width=14, fig.height=12}
# Piirretään kuvaaja, Fig1

#määritetään kuvalle raamit ja nimi
Line=c(-1,1)
Line2=c(-1,1)
Line3=c(0,0)

Line=cbind(Line,Line2)
Line=cbind(Line,Line3)

Line=as.data.frame(Line)

#pdf("Fig1.pdf")
#jpeg("Fig1abcdef.jpeg")
#png("Fig1abcdef.png")

#määrittää 3x3 matriisin johon kuvat piirretään
layout(matrix(c(1,2,7,3,4,7,5,6,7), 3, 3, byrow = TRUE))

# a)
plot(pa_B~pa_A,data=res,xlim=c(-1,1),
     ylim=c(-1,1),cex.axis=0.8,xlab="Prediction accuracy (A)",
     ylab="Prediction accuracy (B)")
lines(Line$Line,Line$Line2,lty="dashed")
lines(Line$Line,Line$Line3,col="grey",lty="dashed")
lines(Line$Line3,Line$Line,col="grey",lty="dashed")

text(-0.5,0.8,"a) Distribution",cex=0.8)

# b)
plot(abu_B~abu_A,data=res,xlim=c(-1,1),
     ylim=c(-1,1),cex.axis=0.8,xlab="Prediction accuracy (A)",
     ylab="Prediction accuracy (B)")
lines(Line$Line,Line$Line2,lty="dashed")
lines(Line$Line,Line$Line3,col="grey",lty="dashed")
lines(Line$Line3,Line$Line,col="grey",lty="dashed")

text(-0.5,0.8,"b) Abundance",cex=0.8)

# c)
plot(pa_D~pa_C,data=res,xlim=c(-1,1),
     ylim=c(-1,1),cex.axis=0.8,xlab="Prediction accuracy (C)",
     ylab="Prediction accuracy (D)")
lines(Line$Line,Line$Line2,lty="dashed")
lines(Line$Line,Line$Line3,col="grey",lty="dashed")
lines(Line$Line3,Line$Line,col="grey",lty="dashed")

text(-0.5,0.8,"c) Distribution, 2 km",cex=0.8)

# d)
plot(abu_D~abu_C,data=res,xlim=c(-1,1),
     ylim=c(-1,1),cex.axis=0.8,xlab="Prediction accuracy (C)",
     ylab="Prediction accuracy (D)")
lines(Line$Line,Line$Line2,lty="dashed")
lines(Line$Line,Line$Line3,col="grey",lty="dashed")
lines(Line$Line3,Line$Line,col="grey",lty="dashed")

text(-0.5,0.8,"d) Abundance, 2 km",cex=0.8)

#dev.off()
```


Millainen kuvaaja olisi hyvä?


## Reittikohtaiset ennustustarkkuudet





